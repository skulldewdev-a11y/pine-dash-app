<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="application-name" content="Pine Dash">
    <meta name="msapplication-TileColor" content="#0a0a0a">
    <meta name="format-detection" content="telephone=no">
    <meta name="screen-orientation" content="any">
    <link rel="manifest" href="manifest.json">
    <title>Pine Dash - OBD2 Bluetooth Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #ff00ff;
            --secondary-color: #00ffff;
            --gradient-start: #0a0a0a;
            --gradient-end: #1a0a1a;
            --glow-color: rgba(255, 0, 255, 0.6);
            --bar-gradient: linear-gradient(90deg, #00ff00 0%, #ffff00 50%, #ff00ff 80%, #ff0000 100%);
            --bg-alpha-light: rgba(255, 0, 255, 0.2);
            --bg-alpha-medium: rgba(255, 0, 255, 0.3);
            --bg-alpha-heavy: rgba(255, 0, 255, 0.6);
            --element-bg: #1a1a2e;
            --element-bg-light: #2a2a3e;
        }
        
        body {
            background: #0a0a0a;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            transition: all 0.5s ease;
        }
        
        .info-banner {
            display: none;
        }
        
        .dashboard {
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
            position: relative;
            display: flex;
            flex-direction: column;
            padding-top: 0px;
            transition: background 0.5s ease;
        }
        
        .rpm-bar-container {
            width: 100%;
            height: 140px;
            padding: 10px;
            position: relative;
        }
        
        .rpm-display-large {
            position: absolute;
            left: 1.5%;
            top: 12px;
            width: 25%;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 99999;
        }
        
        .rpm-label-text {
            font-family: 'Orbitron', monospace;
            color: var(--primary-color);
            font-size: 60px;
            font-weight: 900;
            text-shadow: 0 0 25px var(--primary-color), 0 0 40px var(--primary-color);
            letter-spacing: 5px;
            line-height: 1;
            margin-bottom: 5px;
        }
        
        .rpm-value-text {
            font-family: 'Orbitron', monospace;
            font-size: 105px;
            color: var(--primary-color);
            font-weight: 900;
            text-shadow: 0 0 30px var(--primary-color), 0 0 50px var(--primary-color);
            line-height: 0.9;
        }
        
        .rpm-scale-numbers {
            position: absolute;
            top: 5px;
            left: 30.5%;
            right: 5%;
            display: flex;
            justify-content: space-between;
            z-index: 99999;
            padding: 0 2px;
        }
        
        .rpm-scale-numbers span {
            color: var(--primary-color);
            font-size: 28px;
            font-weight: bold;
            text-shadow: 0 0 15px var(--primary-color);
        }
        
        .rpm-indicators {
            position: absolute;
            top: 38px;
            left: 30.5%;
            right: 5%;
            height: 15px;
            padding: 0 2px;
            z-index: 99999;
        }
        
        .rpm-indicators .rpm-indicator,
        .rpm-indicators .rpm-indicator-small {
            position: absolute;
        }
        
        .rpm-scale-label {
            position: absolute;
            right: 5%;
            bottom: 3px;
            color: var(--primary-color);
            font-size: 11px;
            text-shadow: 0 0 8px var(--primary-color);
            z-index: 99999;
        }

        .rpm-bar {
            position: absolute;
            left: 30.5%;
            right: 5%;
            top: 55px;
            height: 80px;
            background: var(--element-bg);
            border: 6px solid var(--primary-color);
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 0 20px var(--glow-color);
            transition: all 0.5s ease;
        }
        
        .rpm-bar-fill {
            height: 100%;
            background: var(--bar-gradient);
            width: 0%;
            transition: width 0.3s ease;
        }
        

        .main-container {
            flex: 1;
            display: flex;
            padding: 20px;
            gap: 20px;
        }
        
        .left-panel {
            flex: 1.2;
            display: flex;
            flex-direction: column;
            gap: 15px;
            justify-content: flex-end;
        }
        
        .image-container {
            flex: 0.9;
            border: 8px solid var(--primary-color);
            border-radius: 10px;
            background: var(--element-bg-light);
            box-shadow: 0 0 30px var(--glow-color);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            transition: all 0.5s ease;
        }
        
        .camgirl-image {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .camgirl-image.kfc-style {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }
        
        .camgirl-image.cut-style {
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
        }
        
        .camgirl-image.active {
            opacity: 1;
        }
        
        .overlay-gif {
            position: absolute;
            width: 50%;
            height: 50%;
            object-fit: contain;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
            pointer-events: none;
        }
        
        .overlay-gif.active {
            opacity: 1;
        }
        
        .overlay-gif-left {
            bottom: 0;
            left: 0;
            transform: none;
            z-index: 11;
        }
        
        .overlay-gif-center {
            width: 140%;
            height: 140%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }
        
        .rpm-status {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 18px;
            font-style: italic;
            z-index: 11;
        }
        
        .icon-bar {
            height: 70px;
            border: 6px solid var(--primary-color);
            border-radius: 10px;
            background: var(--element-bg);
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 0 30px;
            transition: all 0.5s ease;
        }
        
        .warning-icon {
            font-size: 40px;
            opacity: 0.3;
            transition: all 0.3s ease;
        }
        
        .warning-icon-img {
            height: 40px;
            width: auto;
            opacity: 0.3;
            transition: all 0.3s ease;
            filter: grayscale(100%);
        }
        
        .warning-icon.active {
            opacity: 1;
            animation: blink 1s ease-in-out infinite;
        }
        
        .warning-icon-img.active {
            opacity: 1;
            animation: blink 1s ease-in-out infinite;
            filter: grayscale(0%);
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .gps-box {
            height: 150px;
            border: none;
            border-radius: 10px;
            background: transparent;
            padding: 10px 20px;
            padding-top: 20px;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            transition: all 0.5s ease;
        }
        
        .gps-label {
            font-family: 'Orbitron', monospace;
            color: var(--primary-color);
            font-size: 105px;
            font-weight: 900;
            text-shadow: 0 0 20px var(--primary-color);
            transition: all 0.5s ease;
            letter-spacing: 2px;
        }
        
        .speed-display {
            font-family: 'Orbitron', monospace;
            color: var(--primary-color);
            font-size: 105px;
            font-weight: 900;
            text-shadow: 0 0 20px var(--primary-color);
            transition: all 0.5s ease;
            letter-spacing: 2px;
        }
        
        .chat-box {
            flex: 1;
            border: 6px solid var(--primary-color);
            border-radius: 10px;
            background: var(--element-bg);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            padding: 15px;
            overflow-y: auto;
            transition: all 0.5s ease;
            position: relative;
        }
        
        .chat-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 26, 46, 0.85);
            border-radius: 8px;
            z-index: 0;
        }
        
        .chat-box > * {
            position: relative;
            z-index: 1;
        }
        
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 4px solid var(--primary-color);
            transition: all 0.5s ease;
        }
        
        .chat-title-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .chat-title {
            color: var(--primary-color);
            font-size: 28px;
            font-weight: bold;
            text-shadow: 0 0 10px var(--primary-color);
            transition: all 0.5s ease;
        }
        
        .page-arrows {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .arrow-btn {
            width: 30px;
            height: 30px;
            background: var(--bg-alpha-medium);
            border: 4px solid var(--primary-color);
            border-radius: 5px;
            color: var(--primary-color);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .arrow-btn:hover {
            background: var(--bg-alpha-heavy);
            transform: scale(1.1);
        }
        
        .arrow-btn:active {
            transform: scale(0.95);
        }
        
        /* NUEVO: Bot贸n para cambiar modo gauge/barrita */
        .toggle-mode-btn {
            padding: 5px 10px;
            background: var(--bg-alpha-medium);
            border: 4px solid var(--secondary-color);
            border-radius: 5px;
            color: var(--secondary-color);
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            text-shadow: 0 0 5px var(--secondary-color);
        }
        
        .toggle-mode-btn:hover {
            background: var(--bg-alpha-heavy);
            transform: scale(1.05);
            box-shadow: 0 0 10px var(--secondary-color);
        }
        
        .toggle-mode-btn:active {
            transform: scale(0.95);
        }
        
        .toggle-mode-btn.active-mode {
            background: var(--secondary-color);
            color: #000;
        }
        
        .page-indicator {
            color: var(--secondary-color);
            font-size: 14px;
            font-weight: bold;
            padding: 0 5px;
        }
        
        .fuel-badge {
            color: var(--primary-color);
            font-size: 20px;
            background: var(--bg-alpha-light);
            padding: 5px 12px;
            border-radius: 5px;
            border: 4px solid var(--primary-color);
            transition: all 0.5s ease;
        }
        
        /* Gauges circulares */
        .gauges-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 5px;
            margin-top: 5%;
        }
        
        .sensor-page {
            display: none;
        }
        
        .sensor-page.active {
            display: block;
        }
        
        .gauge-circular {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .gauge-circular svg {
            width: 75%;
            max-width: 144px;
            height: auto;
        }
        
        .gauge-value {
            position: absolute;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 29px;
            font-weight: 900;
            color: var(--secondary-color);
            text-shadow: 0 0 15px currentColor, 0 0 25px currentColor;
            transition: all 0.5s ease;
            font-family: 'Orbitron', monospace;
        }
        
        .gauge-label {
            margin-top: 4px;
            font-size: 13px;
            color: var(--primary-color);
            font-weight: bold;
            text-align: center;
            text-shadow: 0 0 10px var(--primary-color);
            transition: all 0.5s ease;
            letter-spacing: 1px;
        }
        
        /* Barras horizontales */
        .bars-container {
            display: flex;
            flex-direction: column;
            gap: 7px;
            margin-top: 5%;
        }
        
        .bar-item {
            display: flex;
            align-items: center;
            gap: 9px;
        }
        
        .bar-label {
            color: var(--primary-color);
            font-size: 13px;
            min-width: 90px;
            font-weight: bold;
            transition: all 0.5s ease;
            text-shadow: 0 0 8px var(--primary-color);
        }
        
        .bar-track {
            flex: 1;
            height: 22px;
            background: #0a0a1a;
            border-radius: 11px;
            overflow: hidden;
            border: 2px solid var(--primary-color);
        }
        
        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            width: 0%;
            transition: width 0.3s ease, background 0.5s ease;
            border-radius: 11px;
            box-shadow: 0 0 11px var(--glow-color);
        }
        
        .bar-value {
            color: var(--secondary-color);
            font-size: 16px;
            min-width: 45px;
            text-align: right;
            font-weight: 900;
            text-shadow: 0 0 10px var(--secondary-color);
            transition: all 0.5s ease;
            font-family: 'Orbitron', monospace;
        }
        
        .controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: row;
            gap: 8px;
            background: rgba(0, 0, 0, 0.9);
            padding: 10px;
            border-radius: 8px;
            border: 4px solid var(--primary-color);
            z-index: 1000;
            transition: all 0.5s ease;
            align-items: center;
        }
        
        .manual-rpm-control {
            display: flex;
            flex-direction: column;
            gap: 3px;
            padding: 5px;
            background: rgba(0,0,0,0.3);
            border: none;
            border-radius: 5px;
            font-size: 10px;
        }
        
        .control-btn {
            padding: 7px 14px;
            background: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .control-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--glow-color);
        }
        
        .control-btn.connected {
            background: #00ff00;
        }
        
        .control-btn.disconnected {
            background: #ff0000;
        }
        
        .theme-selector {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 9px;
            border-radius: 5px;
            border: none;
            transition: all 0.5s ease;
        }
        
        .usb-status {
            color: var(--primary-color);
            font-size: 10px;
            font-weight: bold;
            padding: 5px 11px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            border: none;
            transition: all 0.5s ease;
            white-space: nowrap;
        }
        
        .usb-status.connected {
            color: #00ff00;
        }
        
        .theme-arrow {
            width: 22px;
            height: 22px;
            background: var(--bg-alpha-light);
            border: none;
            border-radius: 5px;
            color: var(--primary-color);
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .theme-arrow:hover {
            background: var(--bg-alpha-medium);
            transform: scale(1.1);
            box-shadow: 0 0 10px var(--glow-color);
        }
        
        .theme-name {
            color: var(--primary-color);
            font-size: 10px;
            font-weight: bold;
            text-shadow: 0 0 8px var(--primary-color);
            min-width: 68px;
            text-align: center;
            transition: all 0.5s ease;
        }
        
        .rpm-indicator {
            width: 4px;
            height: 15px;
            background: var(--primary-color);
            box-shadow: 0 0 8px var(--primary-color);
            transition: all 0.5s ease;
        }
        
        .rpm-indicator-small {
            width: 2px;
            height: 10px;
            background: var(--primary-color);
            box-shadow: 0 0 4px var(--primary-color);
            transition: all 0.5s ease;
        }
        
        /* ADD SENSOR BUTTON */
        .add-sensor-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            color: #000;
            font-size: 32px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            box-shadow: 0 0 20px var(--glow-color);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px auto;
        }
        
        .add-sensor-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px var(--glow-color);
        }
        
        /* SENSOR MODAL */
        .sensor-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999999;
            align-items: center;
            justify-content: center;
        }
        
        .sensor-modal.active {
            display: flex;
        }
        
        .sensor-modal-content {
            background: var(--element-bg);
            border: 4px solid var(--primary-color);
            border-radius: 15px;
            padding: 25px;
            max-width: 600px;
            max-height: 70vh;
            overflow-y: auto;
            box-shadow: 0 0 40px var(--glow-color);
        }
        
        .sensor-modal-title {
            color: var(--primary-color);
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--primary-color);
        }
        
        .sensor-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .sensor-option {
            padding: 12px;
            background: var(--element-bg-light);
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            color: var(--primary-color);
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .sensor-option:hover {
            background: var(--primary-color);
            color: #000;
            box-shadow: 0 0 15px var(--glow-color);
        }
        
        .sensor-option.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .close-modal-btn {
            margin-top: 20px;
            padding: 10px 30px;
            background: var(--secondary-color);
            color: #000;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .close-modal-btn:hover {
            transform: scale(1.05);
        }
        
        .custom-sensor-item {
            position: relative;
        }
        
        .remove-sensor-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background: #ff0000;
            color: #fff;
            border: none;
            border-radius: 50%;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        /* INTRO STYLES */
        .intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 999999;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            cursor: pointer;
            transition: opacity 0.5s ease;
        }
        
        .intro-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .intro-logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 120px;
            font-weight: 900;
            color: var(--primary-color);
            text-shadow: 
                0 0 20px var(--primary-color),
                0 0 40px var(--primary-color),
                0 0 60px var(--primary-color),
                0 0 80px var(--primary-color);
            letter-spacing: 15px;
            animation: glowPulse 2s ease-in-out infinite, slideIn 1s ease-out;
            margin-bottom: 30px;
        }
        
        .intro-subtitle {
            font-family: 'Orbitron', sans-serif;
            font-size: 32px;
            font-weight: 700;
            color: var(--secondary-color);
            text-shadow: 0 0 15px var(--secondary-color);
            letter-spacing: 8px;
            animation: fadeInUp 1.5s ease-out 0.5s both;
        }
        
        @keyframes glowPulse {
            0%, 100% {
                text-shadow: 
                    0 0 20px var(--primary-color),
                    0 0 40px var(--primary-color),
                    0 0 60px var(--primary-color),
                    0 0 80px var(--primary-color);
            }
            50% {
                text-shadow: 
                    0 0 30px var(--primary-color),
                    0 0 60px var(--primary-color),
                    0 0 90px var(--primary-color),
                    0 0 120px var(--primary-color);
            }
        }
        
        @keyframes loadingPulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }
        
        @keyframes slideIn {
            0% {
                transform: translateY(-100px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeInUp {
            0% {
                transform: translateY(50px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeOut {
            0% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }
        
        @keyframes fadeInOut {
            0% {
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }
        
        @keyframes loadingProgress {
            0% {
                width: 0%;
            }
            100% {
                width: 100%;
            }
        }
        
        @keyframes dashboardFadeIn {
            0% {
                opacity: 0;
                transform: scale(0.95);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* LOADING SCREEN */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 999998;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            opacity: 1;
            transition: opacity 0.5s ease;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 48px;
            font-weight: 900;
            color: var(--primary-color);
            text-shadow: 0 0 20px var(--primary-color);
            letter-spacing: 10px;
            margin-bottom: 30px;
            animation: loadingPulse 1.5s ease-in-out infinite;
        }
        
        .loading-bar-container {
            width: 400px;
            height: 8px;
            background: #1a1a2e;
            border: 3px solid var(--primary-color);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px var(--glow-color);
        }
        
        .loading-bar-fill {
            height: 100%;
            background: var(--bar-gradient);
            width: 0%;
            animation: loadingProgress 2.5s ease-in-out forwards;
        }
        
        .dashboard-container {
            opacity: 1;
        }
        
        /* ============================================ */
        /* BLUETOOTH CONNECTION STYLES */
        /* ============================================ */
        
        .bt-connection {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .bt-btn {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--primary-color);
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
        }
        
        .bt-btn:hover {
            background: var(--primary-color);
            color: #000;
        }
        
        .bt-btn.connected {
            border-color: #00ff00;
            color: #00ff00;
        }
        
        .bt-btn.connecting {
            border-color: #ffff00;
            color: #ffff00;
            animation: pulse 1s infinite;
        }
        
        .bt-status {
            font-family: 'Orbitron', sans-serif;
            font-size: 10px;
            color: var(--secondary-color);
            background: rgba(0, 0, 0, 0.8);
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .bt-icon {
            width: 16px;
            height: 16px;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Estilos para bot贸n BT en barra de controles */
        .control-btn.bt-control {
            background: #ff0066 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        .control-btn.bt-control.connected {
            background: #00ff00 !important;
            color: #000 !important;
        }
        
        .control-btn.bt-control.connecting {
            background: #ffff00 !important;
            color: #000 !important;
            animation: pulse 1s infinite;
        }
        
        .control-btn.bt-control svg {
            fill: currentColor;
        }
        
        /* ============================================ */
        /* RESPONSIVE - ANDROID PHONES */
        /* ============================================ */
        
        /* ============================================ */
        /* RESPONSIVE - MVILES Y TABLETS */
        /* ============================================ */
        
        /* M贸viles en portrait (hasta 600px) */
        @media screen and (max-width: 600px) {
            .dashboard {
                padding-top: 0;
            }
            
            .rpm-bar-container {
                height: 55px !important;
                padding: 3px !important;
            }
            
            /* Ocultar el display grande de RPM en m贸vil */
            .rpm-display-large {
                display: none !important;
            }
            
            /* Ajustar n煤meros de RPM */
            .rpm-scale-numbers {
                left: 5% !important;
                right: 5% !important;
                top: 2px !important;
            }
            
            .rpm-scale-numbers span {
                font-size: 12px !important;
            }
            
            /* Ajustar indicadores de RPM */
            .rpm-indicators {
                left: 5% !important;
                right: 5% !important;
                top: 18px !important;
                height: 8px !important;
            }
            
            .rpm-indicator {
                height: 8px !important;
                width: 2px !important;
            }
            
            .rpm-indicator-small {
                height: 4px !important;
                width: 1px !important;
            }
            
            /* Ajustar barra RPM */
            .rpm-bar {
                left: 5% !important;
                right: 5% !important;
                top: 28px !important;
                height: 24px !important;
                border-width: 2px !important;
            }
            
            /* Ocultar label x1000/RPM */
            .rpm-scale-label {
                display: none !important;
            }
            
            .main-container {
                flex-direction: column !important;
                padding: 5px !important;
                gap: 5px !important;
            }
            
            .left-panel {
                flex: none !important;
                width: 100% !important;
                order: 1;
                gap: 5px !important;
            }
            
            .right-panel {
                flex: 1 !important;
                width: 100% !important;
                order: 2;
                gap: 5px !important;
            }
            
            .image-container {
                height: 28vh !important;
                min-height: 140px;
                border-width: 3px !important;
            }
            
            .icon-bar {
                height: 40px !important;
                border-width: 3px !important;
                padding: 0 8px !important;
            }
            
            .warning-icon {
                font-size: 22px !important;
            }
            
            .warning-icon-img {
                height: 22px !important;
            }
            
            .gps-box {
                height: auto !important;
                min-height: 60px;
                padding: 5px !important;
            }
            
            .gps-label {
                font-size: 10px !important;
            }
            
            .speed-display {
                font-size: 45px !important;
            }
            
            .speed-unit {
                font-size: 10px !important;
            }
            
            .chat-box {
                border-width: 3px !important;
                padding: 6px !important;
                flex: 1 !important;
            }
            
            .chat-title {
                font-size: 14px !important;
            }
            
            .chat-header {
                margin-bottom: 4px !important;
                padding-bottom: 4px !important;
                border-bottom-width: 2px !important;
            }
            
            .page-nav-btn, .arrow-btn {
                width: 24px !important;
                height: 24px !important;
                font-size: 10px !important;
            }
            
            .page-indicator {
                font-size: 10px !important;
            }
            
            .toggle-mode-btn {
                font-size: 8px !important;
                padding: 2px 5px !important;
            }
            
            .fuel-badge {
                font-size: 10px !important;
                padding: 2px 6px !important;
            }
            
            .gauges-grid {
                gap: 5px !important;
                margin-top: 2px !important;
            }
            
            .gauge-circular svg {
                max-width: 68px !important;
                width: 75px !important;
                height: 75px !important;
            }
            
            .gauge-value {
                font-size: 16px !important;
            }
            
            .gauge-label {
                font-size: 8px !important;
                margin-top: 1px !important;
            }
            
            .bars-container {
                gap: 4px !important;
                margin-top: 2px !important;
            }
            
            .bar-item {
                gap: 5px !important;
            }
            
            .bar-label {
                font-size: 9px !important;
                min-width: 55px !important;
            }
            
            .bar-track {
                height: 14px !important;
                border-width: 1px !important;
            }
            
            .bar-value {
                font-size: 10px !important;
                min-width: 30px !important;
            }
            
            .controls {
                position: fixed !important;
                bottom: 3px !important;
                right: 3px !important;
                left: auto !important;
                padding: 4px !important;
                gap: 4px !important;
                flex-direction: row !important;
                border-width: 2px !important;
            }
            
            .theme-selector {
                gap: 3px !important;
            }
            
            .theme-name {
                font-size: 9px !important;
                min-width: 50px !important;
            }
            
            .theme-arrow {
                font-size: 12px !important;
                padding: 2px 5px !important;
            }
            
            .bt-connection {
                top: 2px !important;
                left: 2px !important;
            }
            
            .bt-btn {
                padding: 4px 6px !important;
                font-size: 8px !important;
            }
            
            .bt-status {
                font-size: 7px !important;
                padding: 2px 4px !important;
            }
            
            .bt-icon {
                width: 12px !important;
                height: 12px !important;
            }
            
            .intro-logo {
                font-size: 26px !important;
                letter-spacing: 3px !important;
            }
            
            .intro-subtitle {
                font-size: 12px !important;
            }
            
            .loading-text {
                font-size: 18px !important;
                letter-spacing: 3px !important;
            }
            
            .loading-bar-container {
                width: 75% !important;
                max-width: 220px !important;
            }
            
            .add-sensor-btn {
                width: 32px !important;
                height: 32px !important;
                font-size: 20px !important;
                margin: 5px auto !important;
            }
            
            .sensor-modal-content {
                width: 90% !important;
                max-width: none !important;
                padding: 12px !important;
            }
            
            .sensor-option {
                padding: 8px !important;
                font-size: 11px !important;
            }
            
            .watermark {
                font-size: 10px !important;
                bottom: 3px !important;
                left: 3px !important;
            }
        }
        
        /* M贸viles en landscape - S23 y similares */
        @media screen and (max-width: 1000px) and (orientation: landscape),
               screen and (max-height: 500px) and (orientation: landscape) {
            
            html, body {
                overflow: hidden !important;
                height: 100vh !important;
            }
            
            .dashboard {
                padding-top: 0 !important;
                height: 100vh !important;
            }
            
            /* RPM Bar - MS GRANDE */
            .rpm-bar-container {
                height: 58px !important;
            }
            
            .rpm-display-large {
                display: flex !important;
                flex-direction: column !important;
                align-items: center !important;
                justify-content: center !important;
                transform: none !important;
                left: 1% !important;
                top: 2px !important;
                width: 18% !important;
                height: 54px !important;
            }
            
            .rpm-label-text { font-size: 18px !important; }
            .rpm-value-text { font-size: 32px !important; }
            .rpm-scale-numbers { left: 20% !important; right: 1% !important; top: 3px !important; }
            .rpm-scale-numbers span { font-size: 12px !important; }
            .rpm-indicators { left: 20% !important; right: 1% !important; top: 16px !important; height: 6px !important; }
            .rpm-bar { left: 20% !important; right: 1% !important; top: 24px !important; height: 30px !important; border-width: 3px !important; }
            .rpm-scale-label { display: none !important; }
            
            /* Main Container */
            .main-container {
                flex-direction: row !important;
                padding: 2px !important;
                gap: 3px !important;
                height: calc(100vh - 60px) !important;
            }
            
            /* Panel izquierdo - ALINEADO CON NMERO 3 */
            .left-panel {
                flex: 0 0 38% !important;
                max-width: 38% !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 2px !important;
            }
            
            .image-container {
                flex: 1 !important;
                min-height: 0 !important;
                border-width: 2px !important;
            }
            
            /* ICON BAR - SIEMPRE VISIBLE */
            .icon-bar {
                height: 36px !important;
                min-height: 36px !important;
                flex-shrink: 0 !important;
                border-width: 2px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: space-around !important;
            }
            
            .warning-icon-img {
                height: 22px !important;
            }
            
            /* Panel derecho */
            .right-panel {
                flex: 1 !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 2px !important;
            }
            
            /* Speed */
            .gps-box {
                height: 40px !important;
                padding: 2px 10px !important;
                flex-shrink: 0 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: space-between !important;
            }
            
            .gps-label { font-size: 32px !important; }
            .speed-display { font-size: 32px !important; }
            
            /* Sensors */
            .chat-box {
                flex: 1 !important;
                border-width: 2px !important;
                padding: 3px !important;
                min-height: 0 !important;
                overflow: hidden !important;
            }
            
            .chat-title { font-size: 14px !important; }
            .chat-header { margin-bottom: 3px !important; padding-bottom: 3px !important; }
            .arrow-btn { width: 20px !important; height: 20px !important; font-size: 10px !important; }
            .page-indicator { font-size: 12px !important; }
            .toggle-mode-btn { font-size: 10px !important; padding: 4px 8px !important; }
            .fuel-badge { font-size: 16px !important; padding: 4px 8px !important; }
            
            /* Gauges - MS GRANDES */
            .gauges-grid { gap: 15px !important; }
            .gauge-circular svg { max-width: 68px !important; width: 68px !important; height: 68px !important; }
            .gauge-value { font-size: 16px !important; }
            .gauge-label { font-size: 12px !important; margin-top: 4px !important; }
            
            /* Bars - MS GRANDES Y SEPARADAS */
            .bars-container { gap: 10px !important; }
            .bar-track { height: 16px !important; }
            .bar-label { font-size: 12px !important; min-width: 60px !important; }
            .bar-value { font-size: 12px !important; min-width: 28px !important; }
            
            /* Bot贸n X de borrar sensor */
            .remove-sensor-btn {
                top: -8px !important;
                right: -3px !important;
                width: 16px !important;
                height: 16px !important;
                font-size: 10px !important;
            }
            
            /* CONTROLS - ALINEADOS A LA DERECHA - OCULTOS POR DEFECTO */
            .controls {
                position: fixed !important;
                bottom: 3px !important;
                left: calc(38% + 5px) !important;
                right: 3px !important;
                height: 36px !important;
                padding: 3px 6px !important;
                gap: 5px !important;
                border-radius: 5px !important;
                border-width: 2px !important;
                background: rgba(0, 0, 0, 0.95) !important;
                z-index: 9999 !important;
                display: none !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .theme-selector { gap: 2px !important; }
            .theme-name { font-size: 8px !important; min-width: 30px !important; }
            .theme-arrow { font-size: 10px !important; padding: 2px 4px !important; }
            .control-btn { padding: 4px 7px !important; font-size: 8px !important; }
            .usb-status { font-size: 7px !important; padding: 2px 4px !important; }
            .manual-rpm-control { display: flex !important; align-items: center !important; gap: 3px !important; padding: 2px 4px !important; }
            
            .bt-connection { display: none !important; }
            .watermark { font-size: 5px !important; }
            .info-banner { display: none !important; }
        }
        
        /* Tablets (601px - 1024px) portrait */
        @media screen and (min-width: 601px) and (max-width: 1024px) and (orientation: portrait) {
            .main-container {
                flex-direction: column;
                padding: 12px;
                gap: 12px;
            }
            
            .left-panel {
                flex: none;
                width: 100%;
            }
            
            .right-panel {
                flex: none;
                width: 100%;
            }
            
            .image-container {
                height: 40vh;
            }
            
            .gauge-circular svg {
                max-width: 108px;
            }
            
            .gauge-value {
                font-size: 26px;
            }
        }
        
        /* Desktop (m谩s de 1024px) */
        @media screen and (min-width: 1025px) {
            .gauge-circular svg {
                max-width: 144px;
            }
            
            .gauge-value {
                font-size: 29px;
            }
        }
    </style>
</head>
<body>
    <!-- INTRO SCREEN -->
    <div class="intro-screen" id="introScreen" onclick="startFullscreen()">
        <div class="intro-logo">PINE DASH</div>
        <div class="intro-subtitle">RACING DASHBOARD</div>
        <div style="margin-top: 30px; font-size: 14px; color: var(--secondary-color); animation: blink 1s infinite;">TOCA PARA EMPEZAR</div>
    </div>
    
    <!-- LOADING SCREEN -->
    <div class="loading-screen hidden" id="loadingScreen">
        <div class="loading-text">LOADING...</div>
        <div class="loading-bar-container">
            <div class="loading-bar-fill"></div>
        </div>
    </div>
    
    <!-- DASHBOARD -->
    <div class="dashboard-container">
    <div class="info-banner">
         PINE DASH - Dashboard de Alto Rendimiento | Presiona F11 para pantalla completa
    </div>
    
    <!-- BLUETOOTH CONNECTION UI -->
    <!-- Bot贸n Bluetooth movido a la barra inferior -->
    <div class="bt-connection" style="display: none;">
        <button class="bt-btn" id="btConnectBtnOld" onclick="toggleBluetooth()">
            <svg class="bt-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.71 7.71L12 2h-1v7.59L6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 11 14.41V22h1l5.71-5.71-4.3-4.29 4.3-4.29zM13 5.83l1.88 1.88L13 9.59V5.83zm1.88 10.46L13 18.17v-3.76l1.88 1.88z"/>
            </svg>
            <span>CONECTAR</span>
        </button>
        <div class="bt-status" id="btStatusOld">Desconectado</div>
    </div>
    
    <div class="dashboard" id="dashboard-container">
        <div class="rpm-bar-container">
            <!-- RPM Display grande (se oculta en m贸vil) -->
            <div class="rpm-display-large">
                <div class="rpm-label-text">RPM</div>
                <div class="rpm-value-text" id="rpmDisplay">0</div>
            </div>
            
            <!-- N煤meros de la escala -->
            <div class="rpm-scale-numbers">
                <span>0</span><span>1</span><span>2</span><span>3</span><span>4</span>
                <span>5</span><span>6</span><span>7</span><span>8</span><span>9</span>
            </div>
            
            <!-- Indicadores -->
            <div class="rpm-indicators">
                <div class="rpm-indicator" style="left: 0%;"></div>
                <div class="rpm-indicator-small" style="left: 2.5%;"></div>
                <div class="rpm-indicator-small" style="left: 5.5%;"></div>
                <div class="rpm-indicator-small" style="left: 8.5%;"></div>
                <div class="rpm-indicator" style="left: 11.1%;"></div>
                <div class="rpm-indicator-small" style="left: 13.6%;"></div>
                <div class="rpm-indicator-small" style="left: 16.6%;"></div>
                <div class="rpm-indicator-small" style="left: 19.6%;"></div>
                <div class="rpm-indicator" style="left: 22.2%;"></div>
                <div class="rpm-indicator-small" style="left: 24.7%;"></div>
                <div class="rpm-indicator-small" style="left: 27.7%;"></div>
                <div class="rpm-indicator-small" style="left: 30.7%;"></div>
                <div class="rpm-indicator" style="left: 33.3%;"></div>
                <div class="rpm-indicator-small" style="left: 35.8%;"></div>
                <div class="rpm-indicator-small" style="left: 38.8%;"></div>
                <div class="rpm-indicator-small" style="left: 41.8%;"></div>
                <div class="rpm-indicator" style="left: 44.4%;"></div>
                <div class="rpm-indicator-small" style="left: 46.9%;"></div>
                <div class="rpm-indicator-small" style="left: 49.9%;"></div>
                <div class="rpm-indicator-small" style="left: 52.9%;"></div>
                <div class="rpm-indicator" style="left: 55.5%;"></div>
                <div class="rpm-indicator-small" style="left: 58%;"></div>
                <div class="rpm-indicator-small" style="left: 61%;"></div>
                <div class="rpm-indicator-small" style="left: 64%;"></div>
                <div class="rpm-indicator" style="left: 66.6%;"></div>
                <div class="rpm-indicator-small" style="left: 69.1%;"></div>
                <div class="rpm-indicator-small" style="left: 72.1%;"></div>
                <div class="rpm-indicator-small" style="left: 75.1%;"></div>
                <div class="rpm-indicator" style="left: 77.7%;"></div>
                <div class="rpm-indicator-small" style="left: 80.2%;"></div>
                <div class="rpm-indicator-small" style="left: 83.2%;"></div>
                <div class="rpm-indicator-small" style="left: 86.2%;"></div>
                <div class="rpm-indicator" style="left: 88.8%;"></div>
                <div class="rpm-indicator-small" style="left: 91.3%;"></div>
                <div class="rpm-indicator-small" style="left: 94.3%;"></div>
                <div class="rpm-indicator-small" style="left: 97.3%;"></div>
                <div class="rpm-indicator" style="left: 100%;"></div>
            </div>
            
            <div class="rpm-bar">
                <div class="rpm-bar-fill" id="rpmBarFill"></div>
            </div>
            
            <div class="rpm-scale-label">x1000/RPM</div>
        </div>
        
        <div class="main-container">
            <div class="left-panel">
                <div class="image-container">
                    <img class="camgirl-image" id="img-idle" src="https://i.imgur.com/RBw804Q.png" alt="Idle">
                    <img class="camgirl-image" id="img-500" src="https://i.imgur.com/RBw804Q.png" alt="500">
                    <img class="camgirl-image" id="img-1000" src="https://i.imgur.com/RBw804Q.png" alt="1000">
                    <img class="camgirl-image" id="img-1500" src="https://i.imgur.com/RBw804Q.png" alt="1500">
                    <img class="camgirl-image" id="img-2000" src="https://i.imgur.com/qxWPqH7.png" alt="2000">
                    <img class="camgirl-image" id="img-2250" src="https://i.imgur.com/BVjfz3M.png" alt="2250">
                    <img class="camgirl-image" id="img-2500" src="https://i.imgur.com/yPIOXaC.png" alt="2500">
                    <img class="camgirl-image" id="img-2750" src="https://i.imgur.com/nBqnQS4.png" alt="2750">
                    <img class="camgirl-image" id="img-3000" src="https://i.imgur.com/cxzGHJo.png" alt="3000">
                    <img class="camgirl-image" id="img-3250" src="https://i.imgur.com/d9tXtul.png" alt="3250">
                    <img class="camgirl-image" id="img-3500" src="https://i.imgur.com/AWnmOtL.png" alt="3500">
                    <img class="camgirl-image" id="img-3750" src="https://i.imgur.com/j7YR5NJ.png" alt="3750">
                    <img class="camgirl-image" id="img-4000" src="https://i.imgur.com/vYJzEDy.png" alt="4000">
                    <img class="camgirl-image" id="img-4250" src="https://i.imgur.com/EtLmxhp.png" alt="4250">
                    <img class="camgirl-image" id="img-4500" src="https://i.imgur.com/kdZ5ygT.png" alt="4500">
                    <img class="camgirl-image" id="img-4750" src="https://i.imgur.com/OQ3fqUe.png" alt="4750">
                    <img class="camgirl-image" id="img-5000" src="https://i.imgur.com/D5AXhDR.png" alt="5000">
                    <img class="camgirl-image" id="img-5250" src="https://i.imgur.com/vfxWe2N.png" alt="5250">
                    <img class="camgirl-image" id="img-5500" src="https://i.imgur.com/z9S1W8j.png" alt="5500">
                    <img class="camgirl-image" id="img-5750" src="https://i.imgur.com/TKlhh5y.png" alt="5750">
                    <img class="camgirl-image" id="img-6000" src="https://i.imgur.com/4PeAKqk.png" alt="6000+">
                    <img class="camgirl-image" id="img-6250" src="https://i.imgur.com/4PeAKqk.png" alt="6250">
                    <img class="camgirl-image" id="img-6500" src="https://i.imgur.com/4PeAKqk.png" alt="6500">
                    <img class="camgirl-image" id="img-6750" src="https://i.imgur.com/4PeAKqk.png" alt="6750">
                    <img class="camgirl-image" id="img-7000" src="https://i.imgur.com/4PeAKqk.png" alt="7000">
                    <img class="camgirl-image" id="img-7250" src="https://i.imgur.com/4PeAKqk.png" alt="7250">
                    <img class="camgirl-image" id="img-7500" src="https://i.imgur.com/4PeAKqk.png" alt="7500">
                    <img class="camgirl-image" id="img-7750" src="https://i.imgur.com/4PeAKqk.png" alt="7750">
                    <img class="camgirl-image" id="img-8000" src="https://i.imgur.com/4PeAKqk.png" alt="8000">
                    <img class="camgirl-image" id="img-8250" src="https://i.imgur.com/4PeAKqk.png" alt="8250">
                    <img class="camgirl-image" id="img-8500" src="https://i.imgur.com/4PeAKqk.png" alt="8500">
                    <img class="camgirl-image" id="img-8750" src="https://i.imgur.com/4PeAKqk.png" alt="8750">
                    <img class="camgirl-image" id="img-9000" src="https://i.imgur.com/4PeAKqk.png" alt="9000+">
                    
                    <!-- GIFs superpuestos para la 煤ltima imagen de GIRLS -->
                    <img class="overlay-gif overlay-gif-left" id="overlay-gif-1" src="https://i.imgur.com/3zaT6V7.gif" alt="Overlay 1">
                    <img class="overlay-gif overlay-gif-center" id="overlay-gif-2" src="https://i.imgur.com/qGcAbWw.gif" alt="Overlay 2">
                    
                    <div class="watermark">@Pine-dash</div>
                </div>
                
                <div class="icon-bar">
                    <img class="warning-icon-img" id="leftTurn" src="https://i.imgur.com/tQ6nqgP.png" alt="Left Turn" style="opacity: 0.3;">
                    <img class="warning-icon-img" id="battIcon" src="https://i.imgur.com/itxHeGK.png" alt="Battery" style="opacity: 0.3;">
                    <img class="warning-icon-img" id="tempIcon" src="https://i.imgur.com/BThhs2q.png" alt="Temperature" style="opacity: 0.3;">
                    <img class="warning-icon-img" id="oilIcon" src="https://i.imgur.com/mWPDQ7z.png" alt="Oil" style="opacity: 0.3;">
                    <img class="warning-icon-img" id="rightTurn" src="https://i.imgur.com/H72riaB.png" alt="Right Turn" style="opacity: 0.3;">
                </div>
            </div>
            
            <div class="right-panel">
                <div class="gps-box">
                    <div class="gps-label">SPEED</div>
                    <div class="speed-display" id="speedDisplay">0</div>
                </div>
                
                <div class="chat-box">
                    <div class="chat-header">
                        <div class="chat-title-container">
                            <div class="chat-title">SENSORS</div>
                            <div class="page-arrows">
                                <button class="arrow-btn" onclick="prevSensorPage()"></button>
                                <span class="page-indicator" id="pageIndicator">1/3</span>
                                <button class="arrow-btn" onclick="nextSensorPage()"></button>
                                <button class="toggle-mode-btn" id="toggleModeBtn" onclick="toggleDisplayMode()">GAUGE</button>
                            </div>
                        </div>
                        <div class="fuel-badge" onclick="toggleControls()" style="cursor: pointer;" title="Configuraci贸n">锔</div>
                    </div>
                    
                    <!-- PGINA 1 DE SENSORES -->
                    <div class="sensor-page active" id="sensorPage1">
                        <div id="page1SensorsContainer">
                            <!-- Los sensores se renderizan din谩micamente -->
                        </div>
                    </div>
                    
                    <!-- PGINA 2 DE SENSORES -->
                    <div class="sensor-page" id="sensorPage2">
                        <div id="page2SensorsContainer">
                            <!-- Los sensores se renderizan din谩micamente -->
                        </div>
                    </div>
                    
                    <!-- PGINA 3 DE SENSORES PERSONALIZADOS -->
                    <div class="sensor-page" id="sensorPage3">
                        <!-- Contenedor din谩mico que cambiar谩 seg煤n el modo -->
                        <div id="customSensorsContainer">
                            <!-- Los sensores se a帽adir谩n din谩micamente aqu铆 -->
                        </div>
                        
                        <!-- Bot贸n para a帽adir sensores -->
                        <button class="add-sensor-btn" onclick="openSensorModal()" id="addSensorBtn">+</button>
                    </div>
                </div>
                
                <!-- Controls -->
                <!-- Controls -->
                <div class="controls">
                    <div class="theme-selector">
                        <div class="theme-arrow" onclick="prevTheme()"></div>
                        <div class="theme-name" id="themeName">GIRLS</div>
                        <div class="theme-arrow" onclick="nextTheme()"></div>
                    </div>
                    
                    <div class="manual-rpm-control">
                        <span style="color: var(--primary-color); font-size: 8px;">RPM:</span>
                        <input type="range" id="rpmSlider" min="0" max="9000" value="0" step="100" 
                               style="width: 50px; height: 3px; accent-color: var(--primary-color);"
                               oninput="setManualRPM(this.value)">
                        <span id="manualRpmDisplay" style="color: var(--secondary-color); font-size: 8px;">0</span>
                    </div>
                    
                    <div class="usb-status" id="btStatus">BT: OFF</div>
                    <button class="control-btn bt-control disconnected" id="btConnectBtn" onclick="toggleBluetooth()">
                        <svg style="width:14px;height:14px;vertical-align:middle;" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17.71 7.71L12 2h-1v7.59L6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 11 14.41V22h1l5.71-5.71-4.3-4.29 4.3-4.29zM13 5.83l1.88 1.88L13 9.59V5.83zm1.88 10.46L13 18.17v-3.76l1.88 1.88z"/>
                        </svg>
                        <span id="btBtnText">BT</span>
                    </button>
                    <button class="control-btn" onclick="toggleMode()">DEMO</button>
                    <button class="control-btn" onclick="toggleFullscreen()"></button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let obdData = { rpm: 0, speed: 0, coolant: 0, intakeTemp: 0, voltage: 12.5 };
        let demoMode = true;
        let manualMode = false;
        let manualRPM = 0;
        let connected = false;
        let port = null;
        let reader = null;
        let writer = null;
        let currentImageId = null;
        let currentSensorPage = 1;
        const totalSensorPages = 3;
        
        // NUEVO: Variable para el modo de visualizaci贸n POR PGINA (gauge o bar)
        let displayModes = {
            1: 'gauge',
            2: 'gauge', 
            3: 'gauge'
        };
        
        // Sensores fijos para p谩gina 1
        const page1Sensors = [
            { id: 'water', name: 'Water Temp', unit: '掳C', max: 120, value: 85 },
            { id: 'oilP', name: 'Oil Pressure', unit: 'bar', max: 10, value: 4.2 },
            { id: 'oilT', name: 'Oil Temp', unit: '掳C', max: 150, value: 90 },
            { id: 'boost', name: 'Turbo', unit: 'bar', max: 2.5, value: 0 },
            { id: 'lambda', name: 'Lambda', unit: '位', max: 1.5, value: 1.0 },
            { id: 'afr', name: 'AFR', unit: ':1', max: 18, value: 14.7 }
        ];
        
        // Sensores fijos para p谩gina 2
        const page2Sensors = [
            { id: 'volt', name: 'Voltage', unit: 'V', max: 16, value: 12.5 },
            { id: 'intake', name: 'Intake Temp', unit: '掳C', max: 80, value: 25 },
            { id: 'throttle', name: 'Throttle', unit: '%', max: 100, value: 0 },
            { id: 'maf', name: 'MAF', unit: 'g/s', max: 300, value: 2.5 },
            { id: 'timing', name: 'Timing', unit: '掳', max: 50, value: 15 },
            { id: 'load', name: 'Engine Load', unit: '%', max: 100, value: 45 }
        ];
        
        // Sistema de temas
        let currentTheme = 0;
        const themes = {
            girls: {
                name: 'GIRLS',
                colors: {
                    primary: '#ff00ff',
                    secondary: '#00ffff',
                    gradientStart: '#0a0a0a',
                    gradientEnd: '#1a0a1a',
                    glow: 'rgba(255, 0, 255, 0.6)',
                    barGradient: 'linear-gradient(90deg, #00ff00 0%, #ffff00 50%, #ff00ff 80%, #ff0000 100%)',
                    bgAlphaLight: 'rgba(255, 0, 255, 0.2)',
                    bgAlphaMedium: 'rgba(255, 0, 255, 0.3)',
                    bgAlphaHeavy: 'rgba(255, 0, 255, 0.6)',
                    elementBg: '#1a1a2e',
                    elementBgLight: '#2a2a3e'
                },
                background: 'none',
                images: [
                    { min: 0, max: 444, id: 'img-idle', url: 'https://i.imgur.com/69imzAK.png' },
                    { min: 444, max: 888, id: 'img-500', url: 'https://i.imgur.com/koHvJvn.png' },
                    { min: 888, max: 1333, id: 'img-1000', url: 'https://i.imgur.com/XpT70Zb.png' },
                    { min: 1333, max: 1777, id: 'img-1500', url: 'https://i.imgur.com/iUWgr6s.png' },
                    { min: 1777, max: 2222, id: 'img-2000', url: 'https://i.imgur.com/99YLY73.png' },
                    { min: 2222, max: 2666, id: 'img-2250', url: 'https://i.imgur.com/G1ElohE.png' },
                    { min: 2666, max: 3111, id: 'img-2500', url: 'https://i.imgur.com/E6rcguj.png' },
                    { min: 3111, max: 3555, id: 'img-2750', url: 'https://i.imgur.com/LAxVi7e.png' },
                    { min: 3555, max: 4000, id: 'img-3000', url: 'https://i.imgur.com/3tqexJ1.png' },
                    { min: 4000, max: 4444, id: 'img-3250', url: 'https://i.imgur.com/V5FNzt3.png' },
                    { min: 4444, max: 4888, id: 'img-3500', url: 'https://i.imgur.com/nqYu4Ho.png' },
                    { min: 4888, max: 5333, id: 'img-3750', url: 'https://i.imgur.com/a9t5NhI.png' },
                    { min: 5333, max: 5777, id: 'img-4000', url: 'https://i.imgur.com/ElKCgL2.png' },
                    { min: 5777, max: 6222, id: 'img-4250', url: 'https://i.imgur.com/ipn8HEr.png' },
                    { min: 6222, max: 6666, id: 'img-4500', url: 'https://i.imgur.com/p3AyM4p.png' },
                    { min: 6666, max: 7111, id: 'img-4750', url: 'https://i.imgur.com/JVX1h5Q.png' },
                    { min: 7111, max: 7555, id: 'img-5000', url: 'https://i.imgur.com/WiYIxpk.png' },
                    { min: 7555, max: 8000, id: 'img-5250', url: 'https://i.imgur.com/Rx3O6nw.png' },
                    { min: 8000, max: 20000, id: 'img-5500', url: 'https://i.imgur.com/Rx3O6nw.png' }
                ]
            },

            dragonball: {
                name: 'DRAGON BALL',
                colors: {
                    primary: '#ff8c00',
                    secondary: '#ffd700',
                    gradientStart: '#0a0a0a',
                    gradientEnd: '#1a0e0a',
                    glow: 'rgba(255, 140, 0, 0.6)',
                    barGradient: 'linear-gradient(90deg, #00ff00 0%, #ffff00 50%, #ff8c00 80%, #ff0000 100%)',
                    bgAlphaLight: 'rgba(255, 140, 0, 0.2)',
                    bgAlphaMedium: 'rgba(255, 140, 0, 0.3)',
                    bgAlphaHeavy: 'rgba(255, 140, 0, 0.6)',
                    elementBg: '#1a1a2e',
                    elementBgLight: '#2a2a3e'
                },
                background: 'url(https://i.imgur.com/kHPnaQA.gif)',
                images: [
                    { min: 0, max: 250, id: 'img-idle', url: 'https://i.imgur.com/dTZF9N8.jpg' },
                    { min: 250, max: 500, id: 'img-500', url: 'https://i.imgur.com/mpFgX10.jpg' },
                    { min: 500, max: 750, id: 'img-1000', url: 'https://i.imgur.com/CxAvKy8.jpg' },
                    { min: 750, max: 1000, id: 'img-1500', url: 'https://i.imgur.com/SBSxUvf.jpg' },
                    { min: 1000, max: 1250, id: 'img-2000', url: 'https://i.imgur.com/tGfkK5d.jpg' },
                    { min: 1250, max: 1500, id: 'img-2250', url: 'https://i.imgur.com/DJawOlN.jpg' },
                    { min: 1500, max: 1750, id: 'img-2500', url: 'https://i.imgur.com/O0biAmF.jpg' },
                    { min: 1750, max: 2000, id: 'img-2750', url: 'https://i.imgur.com/caC2eOD.jpg' },
                    { min: 2000, max: 2250, id: 'img-3000', url: 'https://i.imgur.com/wwqFczG.jpg' },
                    { min: 2250, max: 2500, id: 'img-3250', url: 'https://i.imgur.com/jOgHBXs.jpg' },
                    { min: 2500, max: 2750, id: 'img-3500', url: 'https://i.imgur.com/P7QQWT0.jpg' },
                    { min: 2750, max: 3000, id: 'img-3750', url: 'https://i.imgur.com/LBcpe9L.jpg' },
                    { min: 3000, max: 3250, id: 'img-4000', url: 'https://i.imgur.com/S7lB31X.jpg' },
                    { min: 3250, max: 3500, id: 'img-4250', url: 'https://i.imgur.com/hTnnt0G.jpg' },
                    { min: 3500, max: 3750, id: 'img-4500', url: 'https://i.imgur.com/Qu43Dnv.jpg' },
                    { min: 3750, max: 4000, id: 'img-4750', url: 'https://i.imgur.com/2XPHYG6.jpg' },
                    { min: 4000, max: 4250, id: 'img-5000', url: 'https://i.imgur.com/dZX02rV.jpg' },
                    { min: 4250, max: 4500, id: 'img-5250', url: 'https://i.imgur.com/1YrXzIG.jpg' },
                    { min: 4500, max: 4750, id: 'img-5500', url: 'https://i.imgur.com/BMRQWmE.jpg' },
                    { min: 4750, max: 5000, id: 'img-5750', url: 'https://i.imgur.com/MpQYeRa.jpg' },
                    { min: 5000, max: 5250, id: 'img-6000', url: 'https://i.imgur.com/NbYfLkZ.jpg' },
                    { min: 5250, max: 5500, id: 'img-6250', url: 'https://i.imgur.com/zTg6jrq.jpg' },
                    { min: 5500, max: 5750, id: 'img-6500', url: 'https://i.imgur.com/5kr9kI8.jpg' },
                    { min: 5750, max: 6000, id: 'img-6750', url: 'https://i.imgur.com/dNfIuG0.jpg' },
                    { min: 6000, max: 6250, id: 'img-7000', url: 'https://i.imgur.com/erfdYNQ.jpg' },
                    { min: 6250, max: 6500, id: 'img-7250', url: 'https://i.imgur.com/n5GNakI.jpg' },
                    { min: 6500, max: 6750, id: 'img-7500', url: 'https://i.imgur.com/eyq3Ekp.jpg' },
                    { min: 6750, max: 7000, id: 'img-7750', url: 'https://i.imgur.com/8qt824t.jpg' },
                    { min: 7000, max: 7250, id: 'img-8000', url: 'https://i.imgur.com/8RDPyof.jpg' },
                    { min: 7250, max: 7500, id: 'img-8250', url: 'https://i.imgur.com/dBNaAJ3.jpg' },
                    { min: 7500, max: 7750, id: 'img-8500', url: 'https://i.imgur.com/dGiNUjY.gif' },
                    { min: 7750, max: 8000, id: 'img-8750', url: 'https://i.imgur.com/4EUxDJd.gif' },
                    { min: 8000, max: 20000, id: 'img-9000', url: 'https://i.imgur.com/kHPnaQA.jpg' }
                ]
            },
            kfc: {
                name: 'KFC',
                colors: {
                    primary: '#E4002B',
                    secondary: '#000000',
                    gradientStart: '#f5f5f5',
                    gradientEnd: '#ffffff',
                    glow: 'rgba(228, 0, 43, 0.2)',
                    barGradient: 'linear-gradient(90deg, #cccccc 0%, #E4002B 50%, #C00020 80%, #8B0000 100%)',
                    bgAlphaLight: 'rgba(228, 0, 43, 0.1)',
                    bgAlphaMedium: 'rgba(228, 0, 43, 0.15)',
                    bgAlphaHeavy: 'rgba(228, 0, 43, 0.25)',
                    elementBg: '#ffffff',
                    elementBgLight: '#f8f8f8'
                },
                background: 'none',
                images: [
                    { min: 0, max: 444, id: 'img-idle', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 444, max: 888, id: 'img-500', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 888, max: 1333, id: 'img-1000', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 1333, max: 1777, id: 'img-1500', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 1777, max: 2222, id: 'img-2000', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 2222, max: 2666, id: 'img-2250', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 2666, max: 3111, id: 'img-2500', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 3111, max: 3555, id: 'img-2750', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 3555, max: 4000, id: 'img-3000', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 4000, max: 4444, id: 'img-3250', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 4444, max: 4888, id: 'img-3500', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 4888, max: 5333, id: 'img-3750', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 5333, max: 5777, id: 'img-4000', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 5777, max: 6222, id: 'img-4250', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 6222, max: 6666, id: 'img-4500', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 6666, max: 7111, id: 'img-4750', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 7111, max: 7555, id: 'img-5000', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 7555, max: 8000, id: 'img-5250', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 8000, max: 8500, id: 'img-5500', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 8500, max: 9000, id: 'img-5750', url: 'https://i.imgur.com/jsyxM8k.png' },
                    { min: 9000, max: 20000, id: 'img-6000', url: 'https://i.imgur.com/jo3kODl.png' }
                ]
            }
        };
        
        const themeNames = Object.keys(themes);
        let rpmImages = themes[themeNames[currentTheme]].images;
        
        function applyThemeColors(colors) {
            const root = document.documentElement;
            root.style.setProperty('--primary-color', colors.primary);
            root.style.setProperty('--secondary-color', colors.secondary);
            root.style.setProperty('--gradient-start', colors.gradientStart);
            root.style.setProperty('--gradient-end', colors.gradientEnd);
            root.style.setProperty('--glow-color', colors.glow);
            root.style.setProperty('--bar-gradient', colors.barGradient);
            root.style.setProperty('--bg-alpha-light', colors.bgAlphaLight);
            root.style.setProperty('--bg-alpha-medium', colors.bgAlphaMedium);
            root.style.setProperty('--bg-alpha-heavy', colors.bgAlphaHeavy);
            root.style.setProperty('--element-bg', colors.elementBg);
            root.style.setProperty('--element-bg-light', colors.elementBgLight);
        }
        
        function nextTheme() {
            currentTheme = (currentTheme + 1) % themeNames.length;
            switchTheme();
        }
        
        function prevTheme() {
            currentTheme = (currentTheme - 1 + themeNames.length) % themeNames.length;
            switchTheme();
        }
        
        function switchTheme() {
            const themeName = themeNames[currentTheme];
            const theme = themes[themeName];
            rpmImages = theme.images;
            document.getElementById('themeName').textContent = theme.name;
            
            // Guardar tema en localStorage
            localStorage.setItem('pineDashTheme', currentTheme.toString());
            
            // Aplicar colores del tema
            applyThemeColors(theme.colors);
            
            // Cambiar color del subt铆tulo intro para tema KFC
            const introSubtitle = document.querySelector('.intro-subtitle');
            if (introSubtitle) {
                if (themeName === 'kfc') {
                    introSubtitle.style.color = '#ffffff';
                    introSubtitle.style.textShadow = '0 0 15px #ffffff, 0 0 30px #ff0000';
                } else {
                    introSubtitle.style.color = '';
                    introSubtitle.style.textShadow = '';
                }
            }
            
            // Aplicar fondo del tema
            const chatBox = document.querySelector('.chat-box');
            if (theme.background && theme.background !== 'none') {
                chatBox.style.backgroundImage = theme.background;
            } else {
                chatBox.style.backgroundImage = 'none';
            }
            
            // Actualizar las URLs de todas las im谩genes
            theme.images.forEach(img => {
                const imgElement = document.getElementById(img.id);
                if (imgElement) {
                    imgElement.src = img.url;
                    // A帽adir clase kfc-style solo si el tema es KFC
                    if (themeName === 'kfc') {
                        imgElement.classList.add('kfc-style');
                    } else {
                        imgElement.classList.remove('kfc-style');
                    }
                    // A帽adir clase cut-style si es la imagen del corte
                    if (img.url === 'https://i.imgur.com/jo3kODl.png') {
                        imgElement.classList.add('cut-style');
                    } else {
                        imgElement.classList.remove('cut-style');
                    }
                }
            });
            
            // Actualizar la imagen actual seg煤n el RPM
            updateRPMImage(obdData.rpm);
        }
        
        function setManualRPM(value) {
            manualRPM = parseInt(value);
            manualMode = true;
            obdData.rpm = manualRPM;
            document.getElementById('manualRpmDisplay').textContent = manualRPM;
        }
        
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
        
        // Toggle para mostrar/ocultar controles
        let controlsVisible = false;
        function toggleControls() {
            const controls = document.querySelector('.controls');
            controlsVisible = !controlsVisible;
            if (controlsVisible) {
                controls.style.setProperty('display', 'flex', 'important');
            } else {
                controls.style.setProperty('display', 'none', 'important');
            }
        }
        
        async function connectUSB() {
            try {
                port = await navigator.serial.requestPort();
                await port.open({ baudRate: 115200 });
                
                const textDecoder = new TextDecoderStream();
                const readableStreamClosed = port.readable.pipeTo(textDecoder.writable);
                reader = textDecoder.readable.getReader();
                
                const textEncoder = new TextEncoderStream();
                const writableStreamClosed = textEncoder.readable.pipeTo(port.writable);
                writer = textEncoder.writable.getWriter();
                
                await sendCommand('ATZ\r');
                await sleep(300);
                await sendCommand('ATSP0\r');
                await sleep(500);
                
                connected = true;
                demoMode = false;
                
                document.getElementById('obdStatus').textContent = 'USB: CONECTADO ';
                document.getElementById('obdStatus').classList.add('connected');
                document.getElementById('connectBtn').textContent = ' USB OK';
                document.getElementById('connectBtn').classList.remove('disconnected');
                document.getElementById('connectBtn').classList.add('connected');
                
                startOBDLoop();
                
            } catch (error) {
                console.error('Error:', error);
                alert(' Error al conectar:\n' + error.message);
            }
        }
        
        async function sendCommand(cmd) {
            if (!writer) return;
            await writer.write(cmd);
        }
        
        async function readResponse() {
            if (!reader) return '';
            const { value, done } = await reader.read();
            return done ? '' : value;
        }
        
        async function startOBDLoop() {
            while (connected) {
                try {
                    await sendCommand('010C\r');
                    await sleep(50);
                    let response = await readResponse();
                    if (response) obdData.rpm = parseRPM(response);
                    
                    await sendCommand('010D\r');
                    await sleep(50);
                    response = await readResponse();
                    if (response) obdData.speed = parseSpeed(response);
                    
                    await sendCommand('0105\r');
                    await sleep(50);
                    response = await readResponse();
                    if (response) obdData.coolant = parseCoolant(response);
                    
                    await sleep(100);
                } catch (error) {
                    console.error('Error loop:', error);
                }
            }
        }
        
        function parseRPM(data) {
            const match = data.match(/41 0C ([0-9A-F]{2}) ([0-9A-F]{2})/);
            if (!match) return obdData.rpm;
            const A = parseInt(match[1], 16);
            const B = parseInt(match[2], 16);
            return ((A * 256) + B) / 4;
        }
        
        function parseSpeed(data) {
            const match = data.match(/41 0D ([0-9A-F]{2})/);
            if (!match) return obdData.speed;
            return parseInt(match[1], 16);
        }
        
        function parseCoolant(data) {
            const match = data.match(/41 05 ([0-9A-F]{2})/);
            if (!match) return obdData.coolant;
            return parseInt(match[1], 16) - 40;
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        function updateDashboard() {
            let rpm = obdData.rpm;
            if (demoMode) {
                rpm = obdData.rpm;
            }
            
            const rpmPercent = Math.min((rpm / 9000) * 100, 100);
            document.getElementById('rpmBarFill').style.width = rpmPercent + '%';
            document.getElementById('rpmDisplay').textContent = Math.floor(rpm);
            document.getElementById('speedDisplay').textContent = Math.floor(obdData.speed);
            
            updateRPMImage(rpm);
            updateSensorValues(rpm);
            updateWarnings();
        }
        
        function updateRPMImage(rpm) {
            let targetId = 'img-idle';
            for (let img of rpmImages) {
                if (rpm >= img.min && rpm < img.max) {
                    targetId = img.id;
                    break;
                }
            }
            
            if (currentImageId !== targetId) {
                if (currentImageId) {
                    document.getElementById(currentImageId).classList.remove('active');
                }
                document.getElementById(targetId).classList.add('active');
                currentImageId = targetId;
            }
            
            const themeName = themeNames[currentTheme];
            const overlay1 = document.getElementById('overlay-gif-1');
            const overlay2 = document.getElementById('overlay-gif-2');
            
            if (themeName === 'girls' && targetId === 'img-5500') {
                overlay1.classList.add('active');
                overlay2.classList.add('active');
            } else {
                overlay1.classList.remove('active');
                overlay2.classList.remove('active');
            }
        }
        
        function updateSensorValues(rpm) {
            const boost = demoMode ? (rpm / 9000) * 2.0 : (rpm / 4500) * 1.5;
            const coolant = obdData.coolant || (85 + rpm / 200);
            const oilT = coolant + 10;
            const oilP = Math.max(2, 7 - (rpm / 3000));
            const air = 32 + (rpm / 300);
            const lambda = 0.85 + (Math.random() * 0.3);
            const afr = lambda * 14.7;
            
            const voltage = obdData.voltage || 12.5 + (rpm / 10000);
            const intakeTemp = 25 + (rpm / 150);
            const throttle = (rpm / 9000) * 100;
            const maf = 2.5 + (rpm / 2000);
            const timing = 15 + (rpm / 500);
            const engineLoad = (rpm / 9000) * 100;
            
            updateCircularGauge('waterCircle', 'waterGauge', coolant, 120, Math.floor(coolant));
            updateCircularGauge('oilPCircle', 'oilPGauge', oilP, 10, oilP.toFixed(1));
            updateCircularGauge('oilTCircle', 'oilTGauge', oilT, 150, Math.floor(oilT));
            updateCircularGauge('boostCircle', 'boostGauge', boost, 2.5, boost.toFixed(2));
            updateCircularGauge('lambdaCircle', 'lambdaGauge', lambda, 1.5, lambda.toFixed(2));
            updateCircularGauge('afrCircle', 'afrGauge', afr, 18, afr.toFixed(1));
            
            updateCircularGauge('voltCircle', 'voltGauge', voltage, 16, voltage.toFixed(1));
            updateCircularGauge('intake', 'intakeGauge', intakeTemp, 100, Math.floor(intakeTemp));
            updateCircularGauge('throttle', 'throttleGauge', throttle, 100, Math.floor(throttle));
            updateCircularGauge('maf', 'mafGauge', maf, 10, maf.toFixed(1));
            updateCircularGauge('timing', 'timingGauge', timing, 40, Math.floor(timing));
            updateCircularGauge('load', 'loadGauge', engineLoad, 100, Math.floor(engineLoad));
            
            updateBar('waterBar', 'waterValue', coolant, 120, Math.floor(coolant));
            updateBar('oilPBar', 'oilPValue', oilP, 10, oilP.toFixed(1));
            updateBar('oilTBar', 'oilTValue', oilT, 150, Math.floor(oilT));
            updateBar('boostBar', 'boostValue', boost, 2.5, boost.toFixed(2));
            updateBar('lambdaBar', 'lambdaValue', lambda, 1.5, lambda.toFixed(2));
            updateBar('afrBar', 'afrValue', afr, 18, afr.toFixed(1));
            
            updateBar('voltBar', 'voltBarValue', voltage, 16, voltage.toFixed(1));
            updateBar('intakeBar', 'intakeBarValue', intakeTemp, 100, Math.floor(intakeTemp));
            updateBar('throttleBar', 'throttleBarValue', throttle, 100, Math.floor(throttle));
            updateBar('mafBar', 'mafBarValue', maf, 10, maf.toFixed(1));
            updateBar('timingBar', 'timingBarValue', timing, 40, Math.floor(timing));
            updateBar('loadBar', 'loadBarValue', engineLoad, 100, Math.floor(engineLoad));
        }
        
        function updateCircularGauge(circleId, valueId, value, max, displayText) {
            let percent = Math.min((value / max) * 100, 100);
            let offset = 314 - (314 * percent / 100);
            const circleEl = document.getElementById(circleId);
            const valueEl = document.getElementById(valueId);
            if (circleEl) circleEl.style.strokeDashoffset = offset;
            if (valueEl) valueEl.textContent = displayText;
        }
        
        function updateBar(barId, valueId, value, max, displayText) {
            let percent = Math.min((value / max) * 100, 100);
            const barEl = document.getElementById(barId);
            const valueEl = document.getElementById(valueId);
            if (barEl) barEl.style.width = percent + '%';
            if (valueEl) valueEl.textContent = displayText;
        }
        
        function updateWarnings() {
            const coolant = obdData.coolant || 85;
            
            if (demoMode) {
                const tempIcon = document.getElementById('tempIcon');
                tempIcon.src = 'https://i.imgur.com/sUUdB26.png';
                tempIcon.classList.add('active');
                
                const oilIcon = document.getElementById('oilIcon');
                oilIcon.src = 'https://i.imgur.com/WciGXt5.png';
                oilIcon.classList.add('active');
                
                const battIcon = document.getElementById('battIcon');
                battIcon.src = 'https://i.imgur.com/WFBlY8r.png';
                battIcon.classList.add('active');
                
                const leftTurn = document.getElementById('leftTurn');
                leftTurn.src = 'https://i.imgur.com/FQ8R4jD.png';
                leftTurn.classList.add('active');
                
                const rightTurn = document.getElementById('rightTurn');
                rightTurn.src = 'https://i.imgur.com/HoegCq2.png';
                rightTurn.classList.add('active');
            } else {
                const tempIcon = document.getElementById('tempIcon');
                if (coolant > 98) {
                    tempIcon.src = 'https://i.imgur.com/sUUdB26.png';
                    tempIcon.classList.add('active');
                } else {
                    tempIcon.src = 'https://i.imgur.com/BThhs2q.png';
                    tempIcon.classList.remove('active');
                }
                
                const oilP = parseFloat(obdData.oilPressure) || 0;
                const oilIcon = document.getElementById('oilIcon');
                if (oilP > 0 && oilP < 20) {
                    oilIcon.src = 'https://i.imgur.com/WciGXt5.png';
                    oilIcon.classList.add('active');
                } else {
                    oilIcon.src = 'https://i.imgur.com/mWPDQ7z.png';
                    oilIcon.classList.remove('active');
                }
                
                const battIcon = document.getElementById('battIcon');
                const voltage = parseFloat(obdData.voltage) || 14.0;
                if (voltage < 12.5) {
                    battIcon.src = 'https://i.imgur.com/WFBlY8r.png';
                    battIcon.classList.add('active');
                } else {
                    battIcon.src = 'https://i.imgur.com/itxHeGK.png';
                    battIcon.classList.remove('active');
                }
                
                const leftTurn = document.getElementById('leftTurn');
                leftTurn.src = 'https://i.imgur.com/tQ6nqgP.png';
                leftTurn.classList.remove('active');
                
                const rightTurn = document.getElementById('rightTurn');
                rightTurn.src = 'https://i.imgur.com/H72riaB.png';
                rightTurn.classList.remove('active');
            }
        }
        
        function toggleMode() {
            if (connected) {
                connected = false;
                demoMode = true;
                if (port) {
                    port.close();
                    port = null;
                }
                document.getElementById('obdStatus').textContent = 'USB: DESCONECTADO';
                document.getElementById('obdStatus').classList.remove('connected');
                document.getElementById('connectBtn').textContent = ' CONECTAR USB';
                document.getElementById('connectBtn').classList.remove('connected');
                document.getElementById('connectBtn').classList.add('disconnected');
            }
        }
        
        function nextSensorPage() {
            currentSensorPage++;
            if (currentSensorPage > totalSensorPages) {
                currentSensorPage = 1;
            }
            updateSensorPage();
        }
        
        function prevSensorPage() {
            currentSensorPage--;
            if (currentSensorPage < 1) {
                currentSensorPage = totalSensorPages;
            }
            updateSensorPage();
        }
        
        function updateSensorPage() {
            for (let i = 1; i <= totalSensorPages; i++) {
                document.getElementById('sensorPage' + i).classList.remove('active');
            }
            document.getElementById('sensorPage' + currentSensorPage).classList.add('active');
            document.getElementById('pageIndicator').textContent = currentSensorPage + '/' + totalSensorPages;
            
            // Mostrar bot贸n toggle en TODAS las p谩ginas y actualizar su texto
            const toggleBtn = document.getElementById('toggleModeBtn');
            toggleBtn.style.display = 'flex';
            const currentMode = displayModes[currentSensorPage] || 'gauge';
            toggleBtn.textContent = currentMode === 'gauge' ? 'GAUGE' : 'BARRITA';
        }
        
        // Funci贸n para cambiar entre modo gauge y barrita (para la p谩gina actual)
        function toggleDisplayMode() {
            const currentMode = displayModes[currentSensorPage];
            displayModes[currentSensorPage] = currentMode === 'gauge' ? 'bar' : 'gauge';
            
            const btn = document.getElementById('toggleModeBtn');
            btn.textContent = displayModes[currentSensorPage] === 'gauge' ? 'GAUGE' : 'BARRITA';
            
            // Re-renderizar sensores de la p谩gina actual
            if (currentSensorPage === 1) {
                renderPage1Sensors();
            } else if (currentSensorPage === 2) {
                renderPage2Sensors();
            } else if (currentSensorPage === 3) {
                renderCustomSensors();
            }
            
            saveSensorsToStorage(); // Guardar modos en localStorage
        }
        
        let autoDirection = 1;
        function demoAutoUpdate() {
            if (demoMode && !manualMode) {
                obdData.rpm += autoDirection * 50;
                if (obdData.rpm >= 8000) autoDirection = -1;
                if (obdData.rpm <= 0) autoDirection = 1;
                obdData.speed = Math.floor(obdData.rpm / 50);
            }
            updateDashboard();
        }
        
        setInterval(demoAutoUpdate, 100);
        
        obdData.rpm = 0;
        
        // Cargar tema guardado desde localStorage
        const savedTheme = localStorage.getItem('pineDashTheme');
        if (savedTheme !== null) {
            const themeIndex = parseInt(savedTheme);
            if (themeIndex >= 0 && themeIndex < themeNames.length) {
                currentTheme = themeIndex;
            }
        }
        
        const initialTheme = themes[themeNames[currentTheme]];
        applyThemeColors(initialTheme.colors);
        document.getElementById('themeName').textContent = initialTheme.name;
        rpmImages = initialTheme.images;
        
        // Aplicar color del subt铆tulo si es tema KFC
        if (themeNames[currentTheme] === 'kfc') {
            const introSubtitle = document.querySelector('.intro-subtitle');
            if (introSubtitle) {
                introSubtitle.style.color = '#ffffff';
                introSubtitle.style.textShadow = '0 0 15px #ffffff, 0 0 30px #ff0000';
            }
        }
        
        initialTheme.images.forEach(img => {
            const imgElement = document.getElementById(img.id);
            if (imgElement) {
                imgElement.src = img.url;
                if (themeNames[currentTheme] === 'kfc') {
                    imgElement.classList.add('kfc-style');
                }
                if (img.url === 'https://i.imgur.com/jo3kODl.png') {
                    imgElement.classList.add('cut-style');
                }
            }
        });
        
        const chatBox = document.querySelector('.chat-box');
        if (initialTheme.background && initialTheme.background !== 'none') {
            chatBox.style.backgroundImage = initialTheme.background;
        }
        
        updateDashboard();
        
        document.addEventListener('keydown', (e) => {
            if (e.key === 'F11') {
                e.preventDefault();
                toggleFullscreen();
            }
            if (e.key === 'Escape' && document.fullscreenElement) {
                document.exitFullscreen();
            }
        });
        
        // Funci贸n para iniciar en fullscreen al tocar la intro
        function startFullscreen() {
            const intro = document.getElementById('introScreen');
            const loading = document.getElementById('loadingScreen');
            const loadingBar = document.querySelector('.loading-bar-fill');
            
            // Ocultar intro
            intro.classList.add('hidden');
            
            // Mostrar loading y reiniciar animaci贸n de la barra
            loading.classList.remove('hidden');
            loadingBar.style.animation = 'none';
            loadingBar.offsetHeight; // Forzar reflow
            loadingBar.style.animation = 'loadingProgress 2.5s ease-in-out forwards';
            
            // Activar fullscreen
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen().catch(err => console.log('Fullscreen error:', err));
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            }
            
            // Ocultar loading despu茅s de 3 segundos (cuando termine la barra)
            setTimeout(() => {
                loading.classList.add('hidden');
            }, 3000);
        }
        
        // La intro NO se oculta autom谩ticamente - requiere tocar
        
        console.log('ワ CamGirl Dashboard PC - Versi贸n USB');
        console.log(' Hecho por @Pine-dash');
        console.log(' Conecta tu Delphi Autocom por USB');
        
        // ============================================
        // SISTEMA DE SENSORES PERSONALIZADOS MEJORADO
        // ============================================
        
        const availableSensors = [
            { id: 'turbo', name: 'Turbo Boost', unit: 'PSI', max: 30 },
            { id: 'egt', name: 'EGT', unit: '掳C', max: 900 },
            { id: 'knock', name: 'Knock', unit: 'Count', max: 10 },
            { id: 'afr', name: 'AFR', unit: 'Ratio', max: 20 },
            { id: 'trans_temp', name: 'Trans Temp', unit: '掳C', max: 120 },
            { id: 'diff_temp', name: 'Diff Temp', unit: '掳C', max: 120 },
            { id: 'injector_duty', name: 'Injector Duty', unit: '%', max: 100 },
            { id: 'fuel_trim', name: 'Fuel Trim', unit: '%', max: 25 },
            { id: 'catalyst_temp', name: 'Catalyst Temp', unit: '掳C', max: 800 },
            { id: 'evap_pressure', name: 'EVAP Pressure', unit: 'kPa', max: 10 },
            { id: 'barometric', name: 'Barometric', unit: 'kPa', max: 110 },
            { id: 'ambient_temp', name: 'Ambient Temp', unit: '掳C', max: 50 }
        ];
        
        let customSensors = [];
        const maxCustomSensors = 9; // CAMBIADO: De 6 a 9 sensores
        
        // ============================================
        // SISTEMA DE GUARDADO LOCAL (localStorage)
        // ============================================
        
        function saveSensorsToStorage() {
            try {
                const dataToSave = {
                    sensors: customSensors,
                    displayModes: displayModes // Guardar modos de todas las p谩ginas
                };
                localStorage.setItem('pineDashSensors', JSON.stringify(dataToSave));
                console.log(' Configuraci贸n guardada');
            } catch (e) {
                console.warn('锔 No se pudo guardar en localStorage:', e);
            }
        }
        
        function loadSensorsFromStorage() {
            try {
                const saved = localStorage.getItem('pineDashSensors');
                if (saved) {
                    const data = JSON.parse(saved);
                    if (data.sensors && Array.isArray(data.sensors)) {
                        customSensors = data.sensors;
                        console.log(' Sensores cargados:', customSensors.length);
                    }
                    if (data.displayModes) {
                        displayModes = {...displayModes, ...data.displayModes};
                        console.log(' Modos cargados:', displayModes);
                    }
                    // Actualizar bot贸n toggle seg煤n p谩gina actual
                    updateToggleButton();
                    // Renderizar todas las p谩ginas
                    renderPage1Sensors();
                    renderPage2Sensors();
                    renderCustomSensors();
                }
            } catch (e) {
                console.warn('锔 No se pudo cargar de localStorage:', e);
                customSensors = [];
            }
        }
        
        function updateToggleButton() {
            const toggleBtn = document.getElementById('toggleModeBtn');
            if (toggleBtn) {
                const currentMode = displayModes[currentSensorPage] || 'gauge';
                toggleBtn.textContent = currentMode === 'gauge' ? 'GAUGE' : 'BARRITA';
            }
        }
        
        function clearSavedSensors() {
            try {
                localStorage.removeItem('pineDashSensors');
                customSensors = [];
                displayModes = {1: 'gauge', 2: 'gauge', 3: 'gauge'};
                renderPage1Sensors();
                renderPage2Sensors();
                renderCustomSensors();
                console.log('锔 Configuraci贸n borrada');
            } catch (e) {
                console.warn('锔 No se pudo borrar localStorage:', e);
            }
        }
        
        function initializeSensorList() {
            const sensorList = document.getElementById('sensorList');
            sensorList.innerHTML = '';
            
            availableSensors.forEach(sensor => {
                const isAdded = customSensors.some(s => s.id === sensor.id);
                const isMaxReached = customSensors.length >= maxCustomSensors;
                
                const sensorDiv = document.createElement('div');
                sensorDiv.className = 'sensor-option' + (isAdded || isMaxReached ? ' disabled' : '');
                sensorDiv.textContent = sensor.name;
                
                if (!isAdded && !isMaxReached) {
                    sensorDiv.onclick = () => addCustomSensor(sensor);
                }
                
                sensorList.appendChild(sensorDiv);
            });
        }
        
        function openSensorModal() {
            if (customSensors.length >= maxCustomSensors) {
                return;
            }
            initializeSensorList();
            document.getElementById('sensorModal').classList.add('active');
        }
        
        function closeSensorModal() {
            document.getElementById('sensorModal').classList.remove('active');
        }
        
        function addCustomSensor(sensor) {
            if (customSensors.length >= maxCustomSensors) {
                return;
            }
            
            customSensors.push({...sensor});
            renderCustomSensors();
            saveSensorsToStorage(); // Guardar en localStorage
            closeSensorModal();
        }
        
        function removeCustomSensor(sensorId) {
            customSensors = customSensors.filter(s => s.id !== sensorId);
            renderCustomSensors();
            saveSensorsToStorage(); // Guardar en localStorage
        }
        
        // Renderiza sensores de PGINA 1
        function renderPage1Sensors() {
            const container = document.getElementById('page1SensorsContainer');
            container.innerHTML = '';
            
            if (displayModes[1] === 'gauge') {
                const gaugesGrid = document.createElement('div');
                gaugesGrid.className = 'gauges-grid';
                
                page1Sensors.forEach(sensor => {
                    const gaugeDiv = document.createElement('div');
                    gaugeDiv.className = 'gauge-circular';
                    gaugeDiv.innerHTML = `
                        <svg width="140" height="140" viewBox="0 0 120 120">
                            <circle cx="60" cy="60" r="50" fill="none" stroke="#2a2a3e" stroke-width="12"/>
                            <circle id="p1_${sensor.id}_circle" cx="60" cy="60" r="50" fill="none" stroke="var(--primary-color)" stroke-width="12" 
                                    stroke-dasharray="314" stroke-dashoffset="314" 
                                    transform="rotate(-90 60 60)" stroke-linecap="round"/>
                        </svg>
                        <div class="gauge-value" id="p1_${sensor.id}_value">${sensor.value}</div>
                        <div class="gauge-label">${sensor.name}</div>
                    `;
                    gaugesGrid.appendChild(gaugeDiv);
                });
                
                container.appendChild(gaugesGrid);
            } else {
                const barsContainer = document.createElement('div');
                barsContainer.className = 'bars-container';
                
                page1Sensors.forEach(sensor => {
                    const barDiv = document.createElement('div');
                    barDiv.className = 'bar-item';
                    barDiv.innerHTML = `
                        <div class="bar-label">${sensor.name}</div>
                        <div class="bar-track">
                            <div class="bar-fill" id="p1_${sensor.id}_bar"></div>
                        </div>
                        <div class="bar-value" id="p1_${sensor.id}_value">${sensor.value}</div>
                    `;
                    barsContainer.appendChild(barDiv);
                });
                
                container.appendChild(barsContainer);
            }
        }
        
        // Renderiza sensores de PGINA 2
        function renderPage2Sensors() {
            const container = document.getElementById('page2SensorsContainer');
            container.innerHTML = '';
            
            if (displayModes[2] === 'gauge') {
                const gaugesGrid = document.createElement('div');
                gaugesGrid.className = 'gauges-grid';
                
                page2Sensors.forEach(sensor => {
                    const gaugeDiv = document.createElement('div');
                    gaugeDiv.className = 'gauge-circular';
                    gaugeDiv.innerHTML = `
                        <svg width="140" height="140" viewBox="0 0 120 120">
                            <circle cx="60" cy="60" r="50" fill="none" stroke="#2a2a3e" stroke-width="12"/>
                            <circle id="p2_${sensor.id}_circle" cx="60" cy="60" r="50" fill="none" stroke="var(--secondary-color)" stroke-width="12" 
                                    stroke-dasharray="314" stroke-dashoffset="314" 
                                    transform="rotate(-90 60 60)" stroke-linecap="round"/>
                        </svg>
                        <div class="gauge-value" id="p2_${sensor.id}_value">${sensor.value}</div>
                        <div class="gauge-label">${sensor.name}</div>
                    `;
                    gaugesGrid.appendChild(gaugeDiv);
                });
                
                container.appendChild(gaugesGrid);
            } else {
                const barsContainer = document.createElement('div');
                barsContainer.className = 'bars-container';
                
                page2Sensors.forEach(sensor => {
                    const barDiv = document.createElement('div');
                    barDiv.className = 'bar-item';
                    barDiv.innerHTML = `
                        <div class="bar-label">${sensor.name}</div>
                        <div class="bar-track">
                            <div class="bar-fill" id="p2_${sensor.id}_bar"></div>
                        </div>
                        <div class="bar-value" id="p2_${sensor.id}_value">${sensor.value}</div>
                    `;
                    barsContainer.appendChild(barDiv);
                });
                
                container.appendChild(barsContainer);
            }
        }
        
        // Renderiza sensores de PGINA 3 (personalizados)
        function renderCustomSensors() {
            const container = document.getElementById('customSensorsContainer');
            const addBtn = document.getElementById('addSensorBtn');
            
            container.innerHTML = '';
            
            if (displayModes[3] === 'gauge') {
                const gaugesGrid = document.createElement('div');
                gaugesGrid.className = 'gauges-grid';
                
                customSensors.forEach(sensor => {
                    const gaugeDiv = document.createElement('div');
                    gaugeDiv.className = 'gauge-circular custom-sensor-item';
                    gaugeDiv.innerHTML = `
                        <button class="remove-sensor-btn" onclick="removeCustomSensor('${sensor.id}')"></button>
                        <svg width="140" height="140" viewBox="0 0 120 120">
                            <circle cx="60" cy="60" r="50" fill="none" stroke="#2a2a3e" stroke-width="12"/>
                            <circle id="custom_${sensor.id}_circle" cx="60" cy="60" r="50" fill="none" stroke="var(--primary-color)" stroke-width="12" 
                                    stroke-dasharray="314" stroke-dashoffset="314" 
                                    transform="rotate(-90 60 60)" stroke-linecap="round"/>
                        </svg>
                        <div class="gauge-value" id="custom_${sensor.id}_value">0</div>
                        <div class="gauge-label">${sensor.name}</div>
                    `;
                    gaugesGrid.appendChild(gaugeDiv);
                });
                
                container.appendChild(gaugesGrid);
            } else {
                const barsContainer = document.createElement('div');
                barsContainer.className = 'bars-container';
                
                customSensors.forEach(sensor => {
                    const barDiv = document.createElement('div');
                    barDiv.className = 'bar-item custom-sensor-item';
                    barDiv.innerHTML = `
                        <button class="remove-sensor-btn" onclick="removeCustomSensor('${sensor.id}')"></button>
                        <div class="bar-label">@${sensor.name.toLowerCase().replace(/ /g, '_')}</div>
                        <div class="bar-track">
                            <div class="bar-fill" id="custom_${sensor.id}_bar"></div>
                        </div>
                        <div class="bar-value" id="custom_${sensor.id}_value">0</div>
                    `;
                    barsContainer.appendChild(barDiv);
                });
                
                container.appendChild(barsContainer);
            }
            
            if (customSensors.length >= maxCustomSensors) {
                addBtn.style.display = 'none';
            } else {
                addBtn.style.display = 'flex';
            }
        }
        
        // Actualizar sensores p谩gina 1 (demo)
        function updatePage1Sensors() {
            page1Sensors.forEach(sensor => {
                const value = sensor.value + (Math.random() - 0.5) * sensor.max * 0.1;
                const clampedValue = Math.max(0, Math.min(sensor.max, value));
                
                if (displayModes[1] === 'gauge') {
                    const circleId = `p1_${sensor.id}_circle`;
                    const valueId = `p1_${sensor.id}_value`;
                    const displayText = sensor.unit === '位' || sensor.unit === 'bar' ? clampedValue.toFixed(1) : Math.floor(clampedValue);
                    updateCircularGauge(circleId, valueId, clampedValue, sensor.max, displayText);
                } else {
                    const barId = `p1_${sensor.id}_bar`;
                    const valueId = `p1_${sensor.id}_value`;
                    const displayText = sensor.unit === '位' || sensor.unit === 'bar' ? clampedValue.toFixed(1) : Math.floor(clampedValue);
                    updateBar(barId, valueId, clampedValue, sensor.max, displayText);
                }
            });
        }
        
        // Actualizar sensores p谩gina 2 (demo)
        function updatePage2Sensors() {
            page2Sensors.forEach(sensor => {
                const value = sensor.value + (Math.random() - 0.5) * sensor.max * 0.1;
                const clampedValue = Math.max(0, Math.min(sensor.max, value));
                
                if (displayModes[2] === 'gauge') {
                    const circleId = `p2_${sensor.id}_circle`;
                    const valueId = `p2_${sensor.id}_value`;
                    const displayText = sensor.unit === 'V' || sensor.unit === 'g/s' ? clampedValue.toFixed(1) : Math.floor(clampedValue);
                    updateCircularGauge(circleId, valueId, clampedValue, sensor.max, displayText);
                } else {
                    const barId = `p2_${sensor.id}_bar`;
                    const valueId = `p2_${sensor.id}_value`;
                    const displayText = sensor.unit === 'V' || sensor.unit === 'g/s' ? clampedValue.toFixed(1) : Math.floor(clampedValue);
                    updateBar(barId, valueId, clampedValue, sensor.max, displayText);
                }
            });
        }
        
        // Actualizar sensores p谩gina 3 (personalizados - demo)
        function updateCustomSensors() {
            customSensors.forEach(sensor => {
                const value = Math.random() * sensor.max;
                
                if (displayModes[3] === 'gauge') {
                    const circleId = `custom_${sensor.id}_circle`;
                    const valueId = `custom_${sensor.id}_value`;
                    const displayText = sensor.unit === '%' || sensor.unit === 'Ratio' ? value.toFixed(1) : Math.floor(value);
                    updateCircularGauge(circleId, valueId, value, sensor.max, displayText);
                } else {
                    const barId = `custom_${sensor.id}_bar`;
                    const valueId = `custom_${sensor.id}_value`;
                    const displayText = sensor.unit === '%' ? value.toFixed(1) : Math.floor(value);
                    updateBar(barId, valueId, value, sensor.max, displayText);
                }
            });
        }
        
        // Actualizar sensores de la p谩gina activa cada segundo
        setInterval(() => {
            if (currentSensorPage === 1) {
                updatePage1Sensors();
            } else if (currentSensorPage === 2) {
                updatePage2Sensors();
            } else if (currentSensorPage === 3) {
                updateCustomSensors();
            }
        }, 1000);
        
        // Cargar configuraci贸n guardada de localStorage
        loadSensorsFromStorage();
        
        // Inicializar renderizado de todas las p谩ginas
        renderPage1Sensors();
        renderPage2Sensors();
        renderCustomSensors();
        
        // Inicializar p谩gina de sensores
        updateSensorPage();
        
        // ============================================
        // BLUETOOTH OBD2 ELM327 CONNECTION - BLUETOOTH CLASSIC
        // ============================================
        
        let connectedDeviceAddress = null;
        let isConnected = false;
        let isConnecting = false;
        let obdBuffer = '';
        let BluetoothSerial = null;
        
        // Inicializar plugin Capacitor
        document.addEventListener('DOMContentLoaded', async () => {
            // Importar plugin Capacitor
            if (window.Capacitor && window.Capacitor.Plugins) {
                BluetoothSerial = window.Capacitor.Plugins.BluetoothSerial;
                console.log(' Plugin Bluetooth Serial cargado');
            }
        });
        
        // PIDs OBD2 est谩ndar
        const OBD_PIDS = {
            RPM: '010C',
            SPEED: '010D',
            COOLANT_TEMP: '0105',
            INTAKE_TEMP: '010F',
            THROTTLE: '0111',
            ENGINE_LOAD: '0104',
            MAP: '010B',
            VOLTAGE: '0142',
            FUEL_PRESSURE: '010A',
            TIMING_ADVANCE: '010E',
            MAF: '0110',
            LAMBDA: '0134'
        };
        
        // Comandos AT de inicializaci贸n ELM327
        const ELM_INIT_COMMANDS = [
            'ATZ',      // Reset
            'ATE0',     // Echo OFF
            'ATL0',     // Linefeeds OFF
            'ATS0',     // Spaces OFF
            'ATH0',     // Headers OFF
            'ATSP0',    // Auto protocol
            'ATAT1'     // Adaptive timing ON
        ];
        
        function updateBtUI(status, text, btnClass) {
            const btn = document.getElementById('btConnectBtn');
            const statusEl = document.getElementById('btStatus');
            const btnText = document.getElementById('btBtnText');
            
            statusEl.textContent = 'BT: ' + status;
            btnText.textContent = text;
            btn.className = 'control-btn bt-control ' + btnClass;
        }
        
        async function toggleBluetooth() {
            if (isConnected) {
                disconnectBluetooth();
            } else if (!isConnecting) {
                await connectBluetooth();
            }
        }
        
        async function connectBluetooth() {
            // Verificar si estamos en Capacitor (app nativa)
            if (!BluetoothSerial) {
                // Fallback a Web Bluetooth para navegador
                if (navigator.bluetooth) {
                    await connectWebBluetooth();
                } else {
                    alert(' Bluetooth no disponible.\n\nInstala la app Pine Dash para usar Bluetooth Classic.');
                }
                return;
            }
            
            isConnecting = true;
            updateBtUI('Buscando...', 'BUSCANDO', 'connecting');
            
            try {
                // Listar dispositivos emparejados
                const result = await BluetoothSerial.list();
                const devices = result.devices || [];
                
                console.log(' Dispositivos encontrados:', devices);
                
                // Buscar ELM327 o OBD
                let elm327Device = devices.find(d => 
                    d.name && (
                        d.name.toUpperCase().includes('OBD') ||
                        d.name.toUpperCase().includes('ELM') ||
                        d.name.toUpperCase().includes('V-LINK') ||
                        d.name.toUpperCase().includes('VGATE') ||
                        d.name.toUpperCase().includes('VEEPEAK') ||
                        d.name.toUpperCase().includes('ICAR')
                    )
                );
                
                if (!elm327Device && devices.length > 0) {
                    // Si no encuentra ELM327, mostrar lista para elegir
                    const deviceList = devices.map((d, i) => `${i + 1}. ${d.name || 'Sin nombre'}`).join('\n');
                    const choice = prompt(`Selecciona dispositivo (n煤mero):\n${deviceList}`);
                    
                    if (choice && !isNaN(choice)) {
                        elm327Device = devices[parseInt(choice) - 1];
                    }
                }
                
                if (!elm327Device) {
                    throw new Error('No se encontr贸 dispositivo OBD2. Aseg煤rate de emparejarlo primero en Ajustes Bluetooth.');
                }
                
                updateBtUI('Conectando...', 'CONECTANDO', 'connecting');
                console.log(' Conectando a:', elm327Device.name, elm327Device.address);
                
                // Conectar al dispositivo
                await BluetoothSerial.connect({ address: elm327Device.address });
                
                connectedDeviceAddress = elm327Device.address;
                isConnected = true;
                isConnecting = false;
                
                console.log(' Conectado a', elm327Device.name);
                updateBtUI('Inicializando...', 'CONECTADO', 'connected');
                
                // Suscribirse a datos entrantes
                await BluetoothSerial.subscribeRaw({
                    callback: (data) => handleOBDData(data)
                });
                
                // Inicializar ELM327
                await initializeELM327();
                
                // Empezar polling
                startOBDPolling();
                
            } catch (error) {
                console.error(' Error:', error);
                isConnecting = false;
                isConnected = false;
                
                let errorMsg = error.message || 'Error de conexi贸n';
                if (errorMsg.includes('emparej')) {
                    errorMsg = 'Empareja el dispositivo primero';
                }
                
                updateBtUI(errorMsg.substring(0, 20), 'CONECTAR', '');
                alert(' ' + errorMsg);
            }
        }
        
        // Fallback Web Bluetooth para navegador (BLE 4.0)
        async function connectWebBluetooth() {
            isConnecting = true;
            updateBtUI('Buscando BLE...', 'BUSCANDO', 'connecting');
            
            const BLUETOOTH_SERVICE_UUID = '0000ffe0-0000-1000-8000-00805f9b34fb';
            const BLUETOOTH_CHAR_UUID = '0000ffe1-0000-1000-8000-00805f9b34fb';
            
            try {
                const device = await navigator.bluetooth.requestDevice({
                    filters: [
                        { namePrefix: 'OBD' },
                        { namePrefix: 'ELM' },
                        { namePrefix: 'VLINK' },
                        { namePrefix: 'Vgate' },
                        { namePrefix: 'VEEPEAK' },
                        { namePrefix: 'iCar' }
                    ],
                    optionalServices: [BLUETOOTH_SERVICE_UUID]
                });
                
                updateBtUI('Conectando...', 'CONECTANDO', 'connecting');
                const server = await device.gatt.connect();
                const service = await server.getPrimaryService(BLUETOOTH_SERVICE_UUID);
                window.btCharacteristic = await service.getCharacteristic(BLUETOOTH_CHAR_UUID);
                
                await window.btCharacteristic.startNotifications();
                window.btCharacteristic.addEventListener('characteristicvaluechanged', (event) => {
                    const decoder = new TextDecoder();
                    handleOBDData(decoder.decode(event.target.value));
                });
                
                device.addEventListener('gattserverdisconnected', onDisconnected);
                
                isConnected = true;
                isConnecting = false;
                updateBtUI('Inicializando...', 'CONECTADO', 'connected');
                
                await initializeELM327();
                startOBDPolling();
                
            } catch (error) {
                console.error(' Error Web Bluetooth:', error);
                isConnecting = false;
                updateBtUI('Error', 'CONECTAR', '');
            }
        }
        
        async function disconnectBluetooth() {
            try {
                if (BluetoothSerial && connectedDeviceAddress) {
                    await BluetoothSerial.disconnect();
                }
            } catch (e) {
                console.log('Error desconectando:', e);
            }
            onDisconnected();
        }
        
        function onDisconnected() {
            console.log(' Desconectado');
            isConnected = false;
            isConnecting = false;
            connectedDeviceAddress = null;
            
            demoMode = true;
            
            updateBtUI('Desconectado', 'CONECTAR', '');
        }
        
        async function sendOBDCommand(command) {
            if (!isConnected) return;
            
            try {
                const data = command + '\r';
                
                if (BluetoothSerial) {
                    // App nativa - Bluetooth Classic
                    await BluetoothSerial.write({ data: data });
                } else if (window.btCharacteristic) {
                    // Web Bluetooth - BLE
                    const encoder = new TextEncoder();
                    await window.btCharacteristic.writeValue(encoder.encode(data));
                }
                
                console.log(' Enviado:', command);
            } catch (error) {
                console.error('Error enviando:', error);
            }
        }
        
        async function initializeELM327() {
            console.log(' Inicializando ELM327...');
            
            for (const cmd of ELM_INIT_COMMANDS) {
                await sendOBDCommand(cmd);
                await sleep(300);
            }
            
            updateBtUI('ELM327 listo ', 'DESCONECTAR', 'connected');
            console.log(' ELM327 inicializado');
        }
        
        function handleOBDData(data) {
            if (typeof data === 'object' && data.data) {
                // Datos de Capacitor plugin
                obdBuffer += data.data;
            } else if (typeof data === 'string') {
                obdBuffer += data;
            }
            
            // Buscar respuesta completa
            if (obdBuffer.includes('>')) {
                const response = obdBuffer.replace(/>/g, '').trim();
                obdBuffer = '';
                
                if (response && !response.includes('SEARCHING') && !response.includes('NO DATA')) {
                    parseOBDResponse(response);
                }
            }
        }
        
        function parseOBDResponse(response) {
            // Limpiar respuesta
            const clean = response.replace(/\s/g, '').toUpperCase();
            
            // Verificar que sea una respuesta v谩lida (empieza con 41)
            if (!clean.startsWith('41')) return;
            
            const pid = clean.substring(2, 4);
            const dataBytes = clean.substring(4);
            
            switch (pid) {
                case '0C': // RPM
                    if (dataBytes.length >= 4) {
                        const A = parseInt(dataBytes.substring(0, 2), 16);
                        const B = parseInt(dataBytes.substring(2, 4), 16);
                        obdData.rpm = Math.floor(((A * 256) + B) / 4);
                        demoMode = false;
                    }
                    break;
                    
                case '0D': // Velocidad
                    if (dataBytes.length >= 2) {
                        obdData.speed = parseInt(dataBytes.substring(0, 2), 16);
                    }
                    break;
                    
                case '05': // Temperatura refrigerante
                    if (dataBytes.length >= 2) {
                        obdData.coolantTemp = parseInt(dataBytes.substring(0, 2), 16) - 40;
                        // Actualizar sensor p谩gina 1
                        const waterSensor = page1Sensors.find(s => s.id === 'water');
                        if (waterSensor) waterSensor.value = obdData.coolantTemp;
                    }
                    break;
                    
                case '0F': // Temperatura aire admisi贸n
                    if (dataBytes.length >= 2) {
                        obdData.intakeTemp = parseInt(dataBytes.substring(0, 2), 16) - 40;
                        const intakeSensor = page2Sensors.find(s => s.id === 'intake');
                        if (intakeSensor) intakeSensor.value = obdData.intakeTemp;
                    }
                    break;
                    
                case '11': // Throttle
                    if (dataBytes.length >= 2) {
                        obdData.throttle = Math.floor(parseInt(dataBytes.substring(0, 2), 16) * 100 / 255);
                        const throttleSensor = page2Sensors.find(s => s.id === 'throttle');
                        if (throttleSensor) throttleSensor.value = obdData.throttle;
                    }
                    break;
                    
                case '04': // Carga motor
                    if (dataBytes.length >= 2) {
                        obdData.engineLoad = Math.floor(parseInt(dataBytes.substring(0, 2), 16) * 100 / 255);
                        const loadSensor = page2Sensors.find(s => s.id === 'load');
                        if (loadSensor) loadSensor.value = obdData.engineLoad;
                    }
                    break;
                    
                case '0B': // Presi贸n colector (MAP) - puede usarse para estimar boost
                    if (dataBytes.length >= 2) {
                        const mapKpa = parseInt(dataBytes.substring(0, 2), 16);
                        // Convertir a PSI de boost (restando presi贸n atmosf茅rica ~101 kPa)
                        obdData.boost = ((mapKpa - 101) * 0.145).toFixed(1);
                        const boostSensor = page1Sensors.find(s => s.id === 'boost');
                        if (boostSensor) boostSensor.value = Math.max(0, obdData.boost);
                    }
                    break;
                    
                case '42': // Voltaje bater铆a
                    if (dataBytes.length >= 4) {
                        const A = parseInt(dataBytes.substring(0, 2), 16);
                        const B = parseInt(dataBytes.substring(2, 4), 16);
                        obdData.voltage = ((A * 256) + B) / 1000;
                        const voltSensor = page2Sensors.find(s => s.id === 'volt');
                        if (voltSensor) voltSensor.value = obdData.voltage.toFixed(1);
                    }
                    break;
                    
                case '0E': // Timing advance
                    if (dataBytes.length >= 2) {
                        obdData.timing = (parseInt(dataBytes.substring(0, 2), 16) / 2) - 64;
                        const timingSensor = page2Sensors.find(s => s.id === 'timing');
                        if (timingSensor) timingSensor.value = obdData.timing;
                    }
                    break;
                    
                case '10': // MAF
                    if (dataBytes.length >= 4) {
                        const A = parseInt(dataBytes.substring(0, 2), 16);
                        const B = parseInt(dataBytes.substring(2, 4), 16);
                        obdData.maf = ((A * 256) + B) / 100;
                        const mafSensor = page2Sensors.find(s => s.id === 'maf');
                        if (mafSensor) mafSensor.value = obdData.maf.toFixed(1);
                    }
                    break;
            }
            
            // Actualizar dashboard
            updateDashboard();
        }
        
        let obdPollingInterval = null;
        let currentPidIndex = 0;
        const POLLING_PIDS = ['010C', '010D', '0105', '010F', '0111', '0104', '010B', '0142'];
        
        function startOBDPolling() {
            console.log(' Iniciando polling OBD...');
            demoMode = false;
            
            // Polling cada 100ms para alta frecuencia de actualizaci贸n
            obdPollingInterval = setInterval(async () => {
                if (!isConnected) {
                    stopOBDPolling();
                    return;
                }
                
                const pid = POLLING_PIDS[currentPidIndex];
                await sendOBDCommand(pid);
                
                currentPidIndex = (currentPidIndex + 1) % POLLING_PIDS.length;
            }, 100);
        }
        
        function stopOBDPolling() {
            if (obdPollingInterval) {
                clearInterval(obdPollingInterval);
                obdPollingInterval = null;
            }
            demoMode = true;
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // Verificar soporte Bluetooth al cargar
        if (navigator.bluetooth) {
            console.log(' Web Bluetooth disponible');
        } else {
            console.log(' Web Bluetooth NO disponible');
            document.getElementById('btStatus').textContent = 'BT: NO SOPORTADO';
        }
        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registrado:', reg.scope))
                    .catch(err => console.log('SW error:', err));
            });
        }
    </script>
    </div>
    </div> <!-- Cierre dashboard-container -->
    
    <!-- MODAL PARA SELECCIONAR SENSORES -->
    <div class="sensor-modal" id="sensorModal">
        <div class="sensor-modal-content">
            <h2 class="sensor-modal-title">SELECCIONA UN SENSOR</h2>
            <div class="sensor-list" id="sensorList">
                <!-- Los sensores se generar谩n din谩micamente con JavaScript -->
            </div>
            <button class="close-modal-btn" onclick="closeSensorModal()">CERRAR</button>
        </div>
    </div>

</body>
</html>
